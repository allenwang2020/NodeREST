/*
  filename: angular.integralui.treeview.min.js
  version : 3.1.5
  Copyright © 2014-2016 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUITreeViewService",["$rootScope",function(c){var n=null;return{addItem:function(e,g,p){c.$broadcast(e+"-add-item",g,p)},clearItems:function(e,g){c.$broadcast(e+"-clear-items",g)},insertItemAt:function(e,g,p,f){c.$broadcast(e+"-insert-item-at",g,p,f)},insertItemBefore:function(e,g,p){c.$broadcast(e+"-insert-item-before",g,p)},insertItemAfter:function(e,g,p){c.$broadcast(e+"-insert-item-after",g,p)},removeItem:function(e,g){c.$broadcast(e+"-remove-item",
g)},removeItemAt:function(e,g,p){c.$broadcast(e+"-remove-item-at",g,p)},exportToJSON:function(e,g,p,f){c.$broadcast(e+"-export-json",g,p,f);e=this.getTempData();this.clearTempData();return e?e:""},loadData:function(e,g,p,f,k){c.$broadcast(e+"-load-data",g,p,f,k);g=this.getTempData();this.clearTempData();return g?g:null},openEditor:function(e,g){c.$broadcast(e+"-open-editor",g)},closeEditor:function(e,g){c.$broadcast(e+"-close-editor",g)},collapse:function(e,g){c.$broadcast(e+"-collapse",g)},expand:function(e,
g){c.$broadcast(e+"-expand",g)},toggle:function(e,g){c.$broadcast(e+"-toggle",g)},findItemById:function(e,g){c.$broadcast(e+"-find-item-by-id",g);var p=this.getTempData();this.clearTempData();return p?p:null},findItemByText:function(e,g){c.$broadcast(e+"-find-item-by-text",g);var p=this.getTempData();this.clearTempData();return p?p:null},getItemParent:function(e,g){c.$broadcast(e+"-get-item-parent",g);var p=this.getTempData();this.clearTempData();return p?p:null},getItemAt:function(e,g){c.$broadcast(e+
"-get-item-at",g);var p=this.getTempData();this.clearTempData();return p?p:null},filter:function(e,g){c.$broadcast(e+"-filter",g)},focus:function(e,g){c.$broadcast(e+"-focus",g)},clearTempData:function(){n=null},ensureVisible:function(e,g,p){c.$broadcast(e+"-ensure-visible",g,p)},getCheckList:function(e,g){c.$broadcast(e+"-get-check-list",g);var p=this.getTempData();this.clearTempData();return p?p:[]},getItemLevel:function(e,g){c.$broadcast(e+"-get-item-level",g);var p=this.getTempData();this.clearTempData();
return p?p:0},getFlatList:function(e,g){c.$broadcast(e+"-get-flat-list",g);var p=this.getTempData();this.clearTempData();return p?p:[]},getFullPath:function(e,g){c.$broadcast(e+"-get-full-path",g);var p=this.getTempData();this.clearTempData();return p?p:""},getList:function(e,g,p){c.$broadcast(e+"-get-list",g,p);e=this.getTempData();this.clearTempData();return e?e:[]},getTempData:function(){return n},setTempData:function(c){n=c},beginLoad:function(e,g,p){c.$broadcast(e+"-begin-load",g,p)},endLoad:function(e,
g){c.$broadcast(e+"-end-load",g)},moveItem:function(e,g,p,f,k){c.$broadcast(e+"-move-item",g,p,f,k)},clearSelection:function(e){c.$broadcast(e+"-clear-selection")},selectedItem:function(e,g){if(g)c.$broadcast(e+"-set-selected-item",g);else{c.$broadcast(e+"-get-selected-item");var p=this.getTempData();this.clearTempData();return p?p:null}},selectedItems:function(e,g){if(g)c.$broadcast(e+"-set-selected-items",g);else{c.$broadcast(e+"-get-selected-items");var p=this.getTempData();this.clearTempData();
return p?p:null}},getScrollPos:function(e){c.$broadcast(e+"-get-scroll-pos");e=this.getTempData();this.clearTempData();return e?e:{x:0,y:0}},setScrollPos:function(e,g){c.$broadcast(e+"-set-scroll-pos",g)},scrollTo:function(e,g,p){c.$broadcast(e+"-scroll-to",g,p)},sort:function(e,g,p){c.$broadcast(e+"-sort",g,p)},updateCheckValues:function(e,g){c.$broadcast(e+"-update-check",g)},refresh:function(e,g,p){c.$broadcast(e+"-refresh",g,p)},resumeLayout:function(e){c.$broadcast(e+"-resume-layout")},suspendLayout:function(e){c.$broadcast(e+
"-suspend-layout")},updateLayout:function(e){c.$broadcast(e+"-update-layout")},updateView:function(e){c.$broadcast(e+"-update-view")}}}]).controller("IntegralUITreeViewController",["$scope","$element","$timeout","$window","$q","IntegralUIInternalService","IntegralUIDataService","IntegralUITreeViewService","IntegralUIDragDrop","IntegralUIFilter",function(c,n,e,g,p,f,k,m,P,a){var b=this;b.hoverItem=null;this.suppressProcess=!1;b.defaultCheckBoxStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",
disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}};b.defaultStyle={general:"iui-treeview",item:{general:{disabled:"iui-treeview-item-disabled",focused:"iui-treeview-item-focused",normal:"iui-treeview-item",hovered:"iui-treeview-item-hovered",selected:"iui-treeview-item-selected"},checkBox:{general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",
indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}},expandBox:{general:"iui-treeview-expand-box",animated:"iui-treeview-expand-box-load",expanded:"iui-treeview-expand-box-open",collapsed:"iui-treeview-expand-box-close"},content:{disabled:"iui-treeview-item-content-disabled",focused:"iui-treeview-item-content-focused",normal:"iui-treeview-item-content",hovered:"iui-treeview-item-content-hovered",selected:"iui-treeview-item-content-selected"}}};b.defaultCheckBoxSettings=
{autoCheck:!1,style:b.defaultCheckBoxStyle,threeState:!1};this.updateOptions=function(d){d?(b.options={allowAnimation:f.isFieldAvailable(d.allowAnimation,!0),allowDrag:f.isFieldAvailable(d.allowDrag,!1),allowDrop:f.isFieldAvailable(d.allowDrop,!0),allowFocus:f.isFieldAvailable(d.allowFocus,!0),animationSpeed:200,autoCheck:f.isFieldAvailable(d.autoCheck,!1),autoExpand:f.isFieldAvailable(d.autoExpand,!0),checkBoxSettings:b.defaultCheckBoxSettings,controlStyle:b.defaultStyle,editorSettings:{activate:"click"},
enabled:f.isFieldAvailable(d.enabled,!0),hoverSelection:f.isFieldAvailable(d.hoverSelection,!1),indent:f.isFieldAvailable(d.indent,15),itemIcon:f.isFieldAvailable(d.itemIcon,""),itemSpacing:f.isFieldAvailable(d.itemSpacing,1),labelEdit:f.isFieldAvailable(d.labelEdit,!1),loadItems:[],pathSeparator:f.isFieldAvailable(d.pathSeparator,"\\"),rtl:f.isFieldAvailable(d.rtl,!1),selectedIndex:-1,selectedItem:f.isFieldAvailable(d.selectedItem,b.options.selectedItem?b.options.selectedItem:null),selectedItems:[],
selectionMode:f.isFieldAvailable(d.selectionMode,"one"),showCheckBoxes:f.isFieldAvailable(d.showCheckBoxes,!1),showExpandBoxes:f.isFieldAvailable(d.showExpandBoxes,!0),showIcons:f.isFieldAvailable(d.showIcons,!0),showLines:f.isFieldAvailable(d.showLines,!1),showStatusIcons:f.isFieldAvailable(d.showStatusIcons,!1),sorting:f.isFieldAvailable(d.sorting,"none")},b.updateDataFields(d.dataFields),b.updateControlStyle(d.controlStyle),b.updateCheckBoxSettings(d.checkBoxSettings),b.updateTemplateSettings(d.templateSettings)):
(b.options={allowAnimation:!0,allowDrag:!1,allowDrop:!0,allowFocus:!0,animationSpeed:200,autoCheck:!1,autoExpand:!0,checkBoxSettings:b.defaultCheckBoxSettings,controlStyle:b.defaultStyle,editorSettings:{activate:"click"},enabled:!0,hoverSelection:!1,indent:15,itemIcon:"",itemSpacing:1,labelEdit:!1,loadItems:[],pathSeparator:"\\",rtl:!1,selectedIndex:-1,selectedItem:null,selectedItems:[],selectionMode:"one",showCheckBoxes:!1,showExpandBoxes:!0,showIcons:!0,showLines:!1,showStatusIcons:!1,sorting:"none",
templateSettings:{url:null}},b.updateDataFields())};b.options={};this.updateDataFields=function(d){b.options.dataFields=d?{allowDrag:d.allowDrag?d.allowDrag:"allowDrag",allowDrop:d.allowDrop?d.allowDrop:"allowDrop",allowEdit:d.allowEdit?d.allowEdit:"allowEdit",allowFocus:d.allowFocus?d.allowFocus:"allowFocus",autoCheck:d.autoCheck?d.autoCheck:"autoCheck",checkBoxSettings:d.checkBoxSettings?d.checkBoxSettings:"checkBoxSettings",checked:d.checked?d.checked:"checked",checkState:d.checkState?d.checkState:
"checkState",content:d.content?d.content:"content",contextMenu:d.contextMenu?d.contextMenu:"contextMenu",enabled:d.enabled?d.enabled:"enabled",expanded:d.expanded?d.expanded:"expanded",hasChildren:d.hasChildren?d.hasChildren:"hasChildren",icon:d.icon?d.icon:"icon",id:d.id?d.id:"id",items:d.items?d.items:"items",pid:d.pid?d.pid:"pid",statusIcon:d.statusIcon?d.statusIcon:"statusIcon",style:d.style?d.style:"style",templateObj:d.templateObj?d.templateObj:"templateObj",text:d.text?d.text:"text",tooltip:d.tooltip?
d.tooltip:"tooltip",value:d.value?d.value:"value"}:{allowDrag:"allowDrag",allowDrop:"allowDrop",allowEdit:"allowEdit",allowFocus:"allowFocus",autoCheck:"autoCheck",checkBoxSettings:"checkBoxSettings",checked:"checked",checkState:"checkState",content:"content",contextMenu:"contextMenu",enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",items:"items",pid:"pid",statusIcon:"statusIcon",style:"style",templateObj:"templateObj",text:"text",tooltip:"tooltip",value:"value"};
b.dataObj&&b.dataObj.updateDataFields(b.options.dataFields)};this.updateTemplateSettings=function(d){b.options.templateSettings=d?{display:f.isFieldAvailable(d.display,"block"),url:f.isFieldAvailable(d.url,null)}:{display:"block",url:null}};b.updateOptions();c.$on(c.name+"-add-item",function(d,a,c){b.dataObj.insertAt(a,-1,c,b.itemIsAdded)});c.$on(c.name+"-clear-items",function(d,a){b.dataObj.clear(a,b.listIsCleared)});c.$on(c.name+"-insert-item-at",function(d,a,c,h){b.dataObj.insertAt(a,c,h,b.itemIsAdded)});
c.$on(c.name+"-insert-item-after",function(d,a,c){b.dataObj.insertByRef(a,c,!0,b.itemIsAdded)});c.$on(c.name+"-insert-item-before",function(d,a,c){b.dataObj.insertByRef(a,c,!1,b.itemIsAdded)});c.$on(c.name+"-remove-item",function(d,a){b.dataObj.removeAt(a,-1,null,b.itemIsRemoved)});c.$on(c.name+"-remove-item-at",function(d,a,c){b.dataObj.removeAt(null,a,c,b.itemIsRemoved)});this.listIsCleared=function(d){d||(b.clearPrevSelection(),b.options.selectedItem=null,b.setScrollPos({x:0,y:0}));b.updateCurrentLayout()};
this.itemIsAdded=function(){b.updateCurrentLayout()};this.itemIsRemoved=function(d,a,c,h){d&&(d.selected=!1,d==b.options.selectedItem&&(b.options.selectedItem=null));b.updateCurrentLayout()};this.objIsRemoved=function(d,a,c){b.updateCurrentLayout()};this.getCheckValue=function(d){return"checked"==d[b.options.dataFields.checkState]?"checked":1==b.options.checkBoxSettings.threeState&&"indeterminate"==d[b.options.dataFields.checkState]?"indeterminate":"unchecked"};this.changeCheckValue=function(d){if(1==
b.options.autoCheck||1==b.options.checkBoxSettings.autoCheck){var a=b.getCheckValue(d);if(!1!==(1==b.options.checkBoxSettings.threeState?b.callCheckValueChanging(d,a):b.callCheckValueChanging(d,"checked"==a?!0:!1))){if(1==b.options.checkBoxSettings.threeState)switch(a){case "checked":a="unchecked";break;case "indeterminate":a="checked";break;case "unchecked":a="indeterminate"}else a="unchecked"==a||"indeterminate"==a?"checked":"unchecked";d[b.options.dataFields.checkState]=a;d[b.options.dataFields.checked]=
"checked"==a?!0:!1;c.$apply()}}};this.callCheckValueChanging=function(d,a){var l=!0;b.allowEvents&&(l=1==b.options.checkBoxSettings.threeState?angular.isDefined(c.events)&&c.events.itemCheckstateChanging?c.events.itemCheckstateChanging({item:d,value:a}):c.itemCheckstateChanging({e:{item:d,value:a}}):angular.isDefined(c.events)&&c.events.itemCheckedChanging?c.events.itemCheckedChanging({item:d,value:a}):c.itemCheckedChanging({e:{item:d,value:a}}));return l};this.callCheckValueChanged=function(d,a){b.allowEvents&&
(retValue=1==b.options.checkBoxSettings.threeState?angular.isDefined(c.events)&&c.events.itemCheckstateChanged?c.events.itemCheckstateChanged({item:d,value:a}):c.itemCheckstateChanged({e:{item:d,value:a}}):angular.isDefined(c.events)&&c.events.itemCheckedChanged?c.events.itemCheckedChanged({item:d,value:a}):c.itemCheckedChanged({e:{item:d,value:a}}))};var u=[],x=!1;this.fillCheckList=function(d){if(b.allowEvents&&d&&1==b.options.checkBoxSettings.threeState&&!x){x=!0;u.length=0;u.push({item:d,value:d[b.options.dataFields.checkState]});
b.updateListChildItemCheckValue(d);b.updateListParentItemCheckValue(d);for(var a=0,a=0;a<u.length;a++)u[a].item[b.options.dataFields.checkState]=u[a].value;var c=e(function(){a==u.length&&(x=!1);e.cancel(c)},1)}};this.getItemCheckValue=function(d){for(var a="unchecked",c=!1,h=0;h<u.length;h++)if(u[h].item==d){c=!0;a=u[h].value;break}c||(a=d[b.options.dataFields.checkState]);return a};this.updateListParentItemCheckValue=function(d){for(d=b.getParent(d);d;){var a=d[b.options.dataFields.items];if(a){for(var c=
0,h=0,e=0;e<a.length;e++){var f=b.getItemCheckValue(a[e]);"checked"==f?c++:"indeterminate"==f&&h++}e={item:d};e.value=c==a.length?"checked":0<c||0<h?"indeterminate":"unchecked";u.push(e)}d=b.getParent(d)}};this.updateListChildItemCheckValue=function(d){if(d){var a=d[b.options.dataFields.items];if(a)for(var c=0;c<a.length;c++){var h={item:a[c]};"checked"==b.getItemCheckValue(d)?h.value="checked":h.value="unchecked";u.push(h);b.updateListChildItemCheckValue(a[c])}}};this.updateParentItemCheckValue=
function(d){for(d=b.getParent(d);d;){var a=d[b.options.dataFields.items];if(a){for(var c=0,h=0,e=0;e<a.length;e++)"checked"==a[e][b.options.dataFields.checkState]?c++:"indeterminate"==a[e][b.options.dataFields.checkState]&&h++;d[b.options.dataFields.checkState]=c==a.length?"checked":0<c||0<h?"indeterminate":"unchecked"}d=b.getParent(d)}};this.updateItemCheckValue=function(d,a){if("checked"==a||"unchecked"==a)d[b.options.dataFields.checkState]=a;var c=d[b.options.dataFields.items];if(c&&0<c.length)for(var h=
0;h<c.length;h++)b.updateItemCheckValue(c[h],d[b.options.dataFields.checkState]);void 0!=d[b.options.dataFields.checkState]&&(c=b.getParent(d))&&c[b.options.dataFields.checkState]!=d[b.options.dataFields.checkState]&&b.updateParentItemCheckValue(d)};this.updateCheckValues=function(d){if(1==b.options.checkBoxSettings.threeState){d=b.dataObj.getList(d);for(var a=0;a<d.length;a++)b.updateItemCheckValue(d[a])}};c.$on(c.name+"-update-check",function(d,a){b.updateCheckValues(a)});c.$on(c.name+"-get-check-list",
function(d,J){b.updateCheckValues();void 0==J&&(J=1==b.options.checkBoxSettings.threeState?"checked":!0);var c=1==b.options.checkBoxSettings.threeState?b.options.dataFields.checkState:b.options.dataFields.checked,h={operation:"=",value:J},c=a.filter(b.getFullList(),c,h);m.setTempData(c)});this.updateCheckBoxSettings=function(d){b.options.checkBoxSettings=d?{autoCheck:f.isFieldAvailable(d.autoCheck,!1),style:Pa(d.style),threeState:f.isFieldAvailable(d.threeState,!1)}:{autoCheck:!1,style:b.defaultCheckBoxStyle,
threeState:!1}};var y=function(d){return d?a.createTree(d.conditions,d.formula):null},v=function(d){var J=!0;d&&b.filterParams&&(J=(J=d[b.options.dataFields.value])?J:d[b.options.dataFields.text],J=b.filterParams.callback?b.filterParams.callback(J,d):a.match(J,b.filterParams.conditions,b.filterParams.formula,y(b.filterParams)));return J},K=0;b.currentList=[];b.indentList=[];b.parentList=[];b.longestItem=null;b.isThereChildItems=!1;this.updateLongestItem=function(){b.longestItem=null;for(var d=K=0;d<
b.currentList.length;d++){var a=b.currentList[d];if(a[b.options.dataFields.text]){var c=a[b.options.dataFields.text].length;0<b.options.indent&&(c+=b.indentList[d]/b.options.indent);K<c&&(K=c,b.longestItem=a)}}};var T=function(d,a,c,h,e){d.type="item";d[b.options.dataFields.id]||(d[b.options.dataFields.id]=f.getUniqueId());c&&(d[b.options.dataFields.pid]=c);if(c=v(d))h?b.fullList.push(d):(h=a,0!=b.options.showStatusIcons&&(h+=15),b.currentList.push(d),b.indentList.push(h),b.parentList.push({parent:e}),
d[b.options.dataFields.text]&&(e=d[b.options.dataFields.text].length,0<b.options.indent&&(e+=a/b.options.indent),0!=b.options.showStatusIcons&&(e+=15),K<e&&(K=e,b.longestItem=d)));return c};this.isThereVisibleChildren=function(d){var a=!1;if(d&&(d=d[b.options.dataFields.items]))for(var c=0;c<d.length;c++)if(v(d[c])){a=!0;break}return a};this.isThereChildItems=!1;var Q=function(d,a,c,h,e){if(!d[b.options.dataFields.items])return c=T(d,a,c,h,e);if(c=T(d,a,c,h,e)){e=0;var f;if(h||b.isItemExpanded(d)){var k=
d[b.options.dataFields.items];if(k){b.applySorting(k);for(var g=0;g<k.length;g++)(f=Q(k[g],a+b.options.indent,d[b.options.dataFields.id],h,d))&&e++}}h||b.isThereChildItems||!(0<e||!b.isItemExpanded(d)&&d[b.options.dataFields.items]&&0<d[b.options.dataFields.items].length&&b.isThereVisibleChildren(d))||(b.isThereChildItems=!0)}return c};b.fullList=[];this.getFullList=function(d){b.fullList.length=0;d=b.dataObj.getList(d);for(var a=0;a<d.length;a++)Q(d[a],0,null,!0,null);return b.fullList};this.getCurrentList=
function(){return b.currentList};this.updateCurrentList=function(){b.currentList.length=0;b.indentList.length=0;b.parentList.length=0;b.longestItem=null;b.isThereChildItems=!1;K=0;var d=b.dataObj.getList();if(d){b.applySorting(d);for(var a=0;a<d.length;a++)Q(d[a],0,null,!1)}};this.dataEvents={clear:function(d){return angular.isDefined(c.events)&&c.events.clear?c.events.clear({parent:d.e.parent}):c.clear(d)},objAdded:function(d){return angular.isDefined(c.events)&&c.events.itemAdded?c.events.itemAdded({item:d.e.item}):
c.itemAdded(d)},objAdding:function(d){return angular.isDefined(c.events)&&c.events.itemAdding?c.events.itemAdding({item:d.e.item}):c.itemAdding(d)},objRemoved:function(d){return angular.isDefined(c.events)&&c.events.itemRemoved?c.events.itemRemoved({item:d.e.item}):c.itemRemoved(d)},objRemoving:function(d){return angular.isDefined(c.events)&&c.events.itemRemoving?c.events.itemRemoving({item:d.e.item}):c.itemRemoving(d)}};this.getDataFields=function(d){return{content:d.content?d.content:"content",
icon:d.icon?d.icon:"icon",id:d.id?d.id:"id",pid:d.pid?d.pid:"pid",objects:d.items?d.items:"items",statusIcon:d.statusIcon?d.statusIcon:"statusIcon",text:d.text?d.text:"text"}};b.dataObj=new k({objects:c.items,events:b.dataEvents,fields:b.getDataFields(b.options.dataFields)});c.$on(c.name+"-load-data",function(d,a,c,h,e){m.setTempData(b.loadData(a,c,h,e))});c.$on(c.name+"-export-json",function(d,a,c,h){m.setTempData(b.exportToJSON(a,c,h))});this.exportToJSON=function(d,a,c){c=c?c:null;var h=!1!==a?
b.getFullList():b.dataObj.getList();d=d?d:[b.options.dataFields.allowDrag,b.options.dataFields.allowDrop,b.options.dataFields.allowEdit,b.options.dataFields.allowFocus,b.options.dataFields.autoCheck,b.options.dataFields.checkBoxSettings,b.options.dataFields.checked,b.options.dataFields.checkState,b.options.dataFields.content,b.options.dataFields.contextMenu,b.options.dataFields.enabled,b.options.dataFields.expanded,b.options.dataFields.hasChildren,b.options.dataFields.icon,b.options.dataFields.id,
b.options.dataFields.pid,b.options.dataFields.statusIcon,b.options.dataFields.style,b.options.dataFields.templateObj,b.options.dataFields.text,b.options.dataFields.tooltip,b.options.dataFields.value];!1===a&&d.push(b.options.dataFields.items);return JSON.stringify(h,d,c)};this.loadData=function(d,a,l,h){var f=p.defer();b.suspendLayout();b.allowEvents=!1;b.updateDataFields(l);var g=[],n=b.options.dataFields;b.dataObj.clear(a,b.listIsCleared);if(d)if(0!=h){var m=[];d.forEach(function(d,a){var b=d[n.pid];
m[b]?(m[b][n.items]||(m[b][n.items]=[]),m[d[n.id]]=d,m[b][n.items].push(d)):(m[d[n.id]]=d,g.push(d))});m.length=0}else g=d;if(a)for(a[b.options.dataFields.items]=g,d=0;d<a[b.options.dataFields.items].length;d++)a[b.options.dataFields.items][d][b.options.dataFields.pid]=a[b.options.dataFields.id];else if(angular.isDefined(c.items))for(d=c.items.length=0;d<g.length;d++)c.items.push(g[d]);b.dataObj=new k({objects:c.items,events:b.dataEvents,fields:b.getDataFields(b.options.dataFields)});var u=e(function(){b.getTemplateUrl();
b.resumeLayout();b.allowEvents=!0;var d=e(function(){f.resolve();e.cancel(d)},125);e.cancel(u)},100);return f.promise};this.updateData=function(){b.options.dataFields.dataSource&&(b.loadData(b.options.dataFields.dataSource),b.dataObj=new k({objects:c.items,events:b.dataEvents,fields:b.getDataFields(b.options.dataFields)}))};var Z=!1;this.dragDropStatus=function(d){if(void 0!=d)Z=d;else return Z};this.getDnDSource=function(d){return{text:d.dataTransfer?d.dataTransfer.getData("text"):d.originalEvent.dataTransfer?
d.originalEvent.dataTransfer.getData("text"):""}};this.getTouchData=function(d){return d.changedTouches?d.changedTouches:d.originalEvent?d.originalEvent.changedTouches:null};var w=angular.element('<div class="iui-drop-marker" data-element="dropmark"></div>');this.getDropMarkLine=function(){return dropMarkLine};b.getMousePos=function(d){return{x:d.pageX?d.pageX:d.originalEvent?d.originalEvent.pageX:0,y:d.pageY?d.pageY:d.originalEvent?d.originalEvent.pageY:0}};this.getCtrlName=function(){return angular.isDefined(c.name)?
c.name:""};n.bind("dragenter",function(d){d.preventDefault();if(b.options.enabled){var a=P.getData();a.source||(a.source=b.getDnDSource(d));d={event:d,sourceTree:a.sourceCtrl?a.sourceCtrl.getCtrlName():"",dragItem:a.source,targetTree:b.getCtrlName(),targetItem:a.target,mousePos:b.getMousePos(d)};b.callDragEnter(d)}});n.bind("dragover",function(d){d.preventDefault();var a=!0;d.dataTransfer?a="none"===d.dataTransfer.effectAllowed?!1:!0:d.originalEvent&&d.originalEvent.dataTransfer&&(a="none"===d.originalEvent.dataTransfer.effectAllowed?
!1:!0);if(b.options.enabled&&a)if(d.dataTransfer?d.dataTransfer.dropEffect=b.options.allowDrop?"move":"none":d.originalEvent&&d.originalEvent.dataTransfer&&(d.originalEvent.dataTransfer.dropEffect=b.options.allowDrop?"move":"none"),a=P.getData(),a.source||(a.source=b.getDnDSource(d)),P.setData({source:a.source,sourceCtrl:a.sourceCtrl,target:null,dropPos:-1}),a={event:d,sourceTree:a.sourceCtrl?a.sourceCtrl.getCtrlName():"",dragItem:a.source,targetTree:b.getCtrlName(),targetItem:null,isDropAllowed:b.options.allowDrop,
dropPos:-1,mousePos:b.getMousePos(d)},0==b.callDragOver(a))d.dataTransfer?d.dataTransfer.dropEffect="none":d.originalEvent&&d.originalEvent.dataTransfer&&(d.originalEvent.dataTransfer.dropEffect="none"),b.dropMark();else{a=b.getMousePos(d);d=a.y+16;var a=a.x+20,l=b.getDropMarkWindow();l.empty();l.append("<span class='iui-drop-marker-move-end'></span><span class='iui-drop-marker-title'>"+(c.name?c.name:"TreeView")+"</span>");b.updateDropMarkElem(b.getDropMarkWindow(),{top:d,left:a});b.dropMark(!0)}});
n.bind("drop",function(d){d.preventDefault();b.dropMark();var a=!0;d.dataTransfer?a="none"===d.dataTransfer.effectAllowed?!1:!0:d.originalEvent&&d.originalEvent.dataTransfer&&(a="none"===d.originalEvent.dataTransfer.effectAllowed?!1:!0);if(b.options.enabled&&a&&(a=P.getData(),a.source||(a.source=b.getDnDSource(d)),a.source)){var l={event:d,sourceTree:a.sourceCtrl?a.sourceCtrl.getCtrlName():"",dragItem:a.source,targetTree:b.getCtrlName(),targetItem:null,isDropAllowed:b.options.allowDrop,dropPos:-1,
mousePos:b.getMousePos(d)};!1!==b.callDragDrop(l)&&(b.drop(a),c.$$phase||c.$apply())}P.clearData();d.stopPropagation()});n.bind("dragleave",function(d){d.preventDefault();if(b.options.enabled){b.dropMark();var a=P.getData();a.source||(a.source=b.getDnDSource(d));d={event:d,sourceTree:a.sourceCtrl?a.sourceCtrl.getCtrlName():"",dragItem:a.source,targetTree:b.getCtrlName(),targetItem:a.target,mousePos:b.getMousePos(d)};b.callDragLeave(d);b.cancelScrollTimer()}});n.bind("dragend",function(d){d.preventDefault();
b.options.enabled&&(b.dropMark(),P.getData().source||P.clearData(),b.dragDropStatus(!1))});n.bind("mouseleave",function(d){d.preventDefault();b.dropMark();b.hoverItem=null});this.containsMousePos=function(d,a){return P.hitTest(d,a,{left:0,top:0,right:n[0].clientWidth,bottom:n[0].clientHeight})};this.isPopupActive=function(){return!1};var Ra=function(d,a){var c=b.options.dataFields;d[c.items]||(d[c.items]=[]);d[c.items].length=0;if(d[a.rows]&&0<d[a.rows].length)for(var h=0;h<d[a.rows].length;h++)d[c.items].push(Ra(d[a.rows][h],
a));return d},ja=function(d,a){var c=!1;a.sourceCtrl&&(c=a.sourceCollection.removeAt(d,-1,null,a.sourceCtrl.objIsRemoved));c&&("row"==d.type&&(d=Ra(d,a.sourceCtrl.options.rowFields)),0===a.dropPos?b.dataObj.insertAt(d,-1,a.target,b.itemIsAdded):1===a.dropPos||2===a.dropPos?1===a.dropPos?b.dataObj.insertByRef(d,a.target,!1,b.itemIsAdded):b.dataObj.insertByRef(d,a.target,!0,b.itemIsAdded):b.dataObj.insertAt(d,-1,null,b.itemIsAdded))};this.setDropSelection=function(d,a){var c=d;!c&&0<=a&&a<b.currentList.length&&
(c=b.currentList[a]);b.clearPrevSelection(c);b.itemSelection(null,c)};this.drop=function(d){if(d&&d.sourceCtrl){d.sourceCtrl.suppressProcess=!0;d.sourceCtrl.suspendLayout();b.suspendLayout();var a=d.source;if(Array.isArray(d.source)){for(var l=[],h=0;h<d.source.length;h++){for(var f=!1,g=d.sourceCollection.getParent(d.source[h]);g;){if(d.sourceCtrl.isObjInSelList(g)){f=!0;break}g=d.sourceCollection.getParent(g)}f||l.push(d.source[h])}if(0<l.length)if(a=l[l.length-1],h=d.sourceCtrl.getObjCurrentIndex(l[0]),
f=d.sourceCtrl.getObjCurrentIndex(a),h<=f)for(h=0;h<l.length;h++)ja(l[h],d);else for(h=l.length-1;0<=h;h--)ja(l[h],d)}else ja(d.source,d);d.sourceCtrl!==b?(b.allowUpdate=!0,d.sourceCtrl.allowUpdate=!0,b.updateCurrentLayout(),d.sourceCtrl.updateCurrentLayout()):(b.allowUpdate=!0,b.updateCurrentLayout());d.sourceCtrl.multiSelection(!1);var k=e(function(){if(a){d.sourceCtrl.clearPrevSelection(a);b.itemSelection(null,a);var l=b.getElemFromItem(a);l&&(l=b.getElement(l))&&l[0].focus();c.$apply();e.cancel(k)}},
1);d.sourceCtrl.suppressProcess=!1}};this.isDragAllowed=function(d){return b.options.allowDrag?d&&(d[b.options.dataFields.allowDrag]||void 0===d[b.options.dataFields.allowDrag])?!0:!1:!1};this.isChildOf=function(d,a){var c=!1;if(d&&a){var h=a[b.options.dataFields.items];if(h&&0<h.length)for(var e=0;e<h.length;e++){if(f.isEqual(d[b.options.dataFields.id],h[e][b.options.dataFields.id])){c=!0;break}else c=b.isChildOf(d,h[e]);if(c)break}}return c};this.isParentOf=function(d,a){var c=b.dataObj.getParent(a);
return d&&a&&c&&f.isEqual(d[b.options.dataFields.id],c[b.options.dataFields.id])?!0:!1};this.isDropAllowed=function(d,a,c){var h=b.options.allowDrop;if(h&&d&&a&&(h=a[b.options.dataFields.allowDrop]||void 0===a[b.options.dataFields.allowDrop]?!0:!1))if(Array.isArray(d))for(var e=0;e<d.length;e++){if(f.isEqual(d[e][b.options.dataFields.id],a[b.options.dataFields.id])||0===c&&b.isParentOf(a,d[e])||b.isChildOf(a,d[e])){h=!1;break}if(!h)break}else if(f.isEqual(d[b.options.dataFields.id],a[b.options.dataFields.id])||
0===c&&b.isParentOf(a,d)||b.isChildOf(a,d))h=!1;return h};this.getDropMarkWindow=function(){for(var d=w,a=angular.element(document.body).children(),b=0;b<a.length;b++){var c=angular.element(a[b]);if(c[0].attributes&&c[0].attributes["data-element"]&&"dropmark"===c[0].attributes["data-element"].value){d=c;break}}return d};this.dropMark=function(d,a){a||(a=b.getDropMarkWindow());if(a){var c="none";this.options.allowDrop&&(c=d?"block":"none");angular.element(a).css("display",c)}};this.updateDropMarkElem=
function(a,b){a&&b&&(a.css("top",b.top+"px"),a.css("left",b.left+"px"),a.css("width",b.width+"px"))};var Ca=!1,U=angular.element('<input type="text" style="position:absolute" />');this.labelEditStatus=function(a){if(void 0!=a)Ca=a;else return Ca};this.getEditBox=function(){return U};this.updateEditBox=function(a){U&&a&&(U.css("top",a.top+"px"),U.css("left",a.left+"px"),U.css("width",a.width+"px"),U.css("height",a.height+"px"))};c.$on(c.name+"-open-editor",function(a,c){b.openEditor(c)});c.$on(c.name+
"-close-editor",function(a,c){b.closeEditor(c)});this.updateEditorSettings=function(a){b.options.editorSettings=a?{activate:f.isFieldAvailable(a.activate,"click")}:{activate:"click"}};this.allowEvents=!0;this.callAfterCollapse=function(a){angular.isDefined(c.events)&&c.events.afterCollapse&&c.events.afterCollapse({item:a});c.afterCollapse({e:{item:a}})};this.callAfterExpand=function(a){angular.isDefined(c.events)&&c.events.afterExpand&&c.events.afterExpand({item:a});c.afterExpand({e:{item:a}})};this.callAfterEdit=
function(a){angular.isDefined(c.events)&&c.events.afterEdit&&c.events.afterEdit({item:a});c.afterEdit({e:{item:a}})};this.callAfterLabelEdit=function(a){angular.isDefined(c.events)&&c.events.afterLabelEdit&&c.events.afterLabelEdit({item:a});c.afterLabelEdit({e:{item:a}})};this.callAfterSelect=function(a){angular.isDefined(c.events)&&c.events.afterSelect?c.events.afterSelect({item:a}):c.afterSelect({e:{item:a}});angular.isDefined(c.events)&&c.events.selectionChanged?c.events.selectionChanged({item:a}):
c.selectionChanged({e:{item:a}})};this.callBeforeCollapse=function(a){return angular.isDefined(c.events)&&c.events.beforeCollapse?c.events.beforeCollapse({item:a}):c.beforeCollapse({e:{item:a}})};this.callBeforeExpand=function(a){return angular.isDefined(c.events)&&c.events.beforeExpand?c.events.beforeExpand({item:a}):c.beforeExpand({e:{item:a}})};this.callBeforeEdit=function(a){return angular.isDefined(c.events)&&c.events.beforeEdit?c.events.beforeEdit({item:a}):c.beforeEdit({e:{item:a}})};this.callBeforeLabelEdit=
function(a){return angular.isDefined(c.events)&&c.events.beforeLabelEdit?c.events.beforeLabelEdit({item:a}):c.beforeLabelEdit({e:{item:a}})};this.callChange=function(){angular.isDefined(c.events)&&c.events.change?c.events.change():c.change()};this.callDragEnter=function(a){angular.isDefined(c.events)&&c.events.dragEnter?c.events.dragEnter({event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}):c.dragEnter({e:{event:a.event,sourceTree:a.sourceTree,
dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}})};this.callDragOver=function(a){return angular.isDefined(c.events)&&c.events.dragOver?c.events.dragOver({event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):c.dragOver({e:{event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,
dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragDrop=function(a){return angular.isDefined(c.events)&&c.events.dragDrop?c.events.dragDrop({event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):c.dragDrop({e:{event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};
this.callDragLeave=function(a){angular.isDefined(c.events)&&c.events.dragLeave?c.events.dragLeave({event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}):c.dragLeave({e:{event:a.event,sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}})};this.callEnabledChanged=function(a){angular.isDefined(c.events)&&c.events.enabledChanged?c.events.enabledChanged({enabled:a}):c.enabledChanged({e:{enabled:a}})};
this.callItemClick=function(a,b,l){angular.isDefined(c.events)&&c.events.itemClick&&c.events.itemClick({event:a,item:b,mousePos:l});c.itemClick({e:{event:a,item:b,mousePos:l}})};this.callItemDblClick=function(a,b){return angular.isDefined(c.events)&&c.events.itemDblClick?c.events.itemDblClick({item:a,mousePos:b}):c.itemDblclick({e:{item:a,mousePos:b}})};this.callItemHover=function(a){angular.isDefined(c.events)&&c.events.itemHover?c.events.itemHover({item:a}):c.itemHover({e:{item:a}})};this.callItemRightClick=
function(a,b){angular.isDefined(c.events)&&c.events.itemRightClick&&c.events.itemRightClick({item:a,mousePos:b});c.itemRightclick({e:{item:a,mousePos:b}})};this.callKeyDown=function(a,b){angular.isDefined(c.events)&&c.events.keyDown?c.events.keyDown({event:a,item:b}):c.keyDown({e:{event:a,item:b}})};this.callKeyPress=function(a,b){angular.isDefined(c.events)&&c.events.keyPress?c.events.keyPress({event:a,item:b}):c.keyPress({e:{event:a,item:b}})};this.callKeyUp=function(a,b){angular.isDefined(c.events)&&
c.events.keyUp?c.events.keyUp({event:a,item:b}):c.keyUp({e:{event:a,item:b}})};this.callScrollPosChanged=function(){angular.isDefined(c.events)&&c.events.scrollPosChanged?c.events.scrollPosChanged({scrollPos:b.scrollPos}):c.scrollposChanged({e:{scrollPos:b.scrollPos}})};n.bind("click",function(a){b.options.enabled&&1===a.which&&b.callItemClick(a,null,b.getMousePos(a))});n.bind("dblclick",function(a){a.preventDefault();b.options.enabled&&1===a.which&&b.callItemDblClick(null,b.getMousePos(a));a.stopPropagation()});
n.bind("mousedown",function(a){b.options.enabled&&3===a.which&&b.callItemRightClick(null,b.getMousePos(a));a.stopPropagation()});this.expandList=[];this.expandIndentList=[];this.expandParentList=[];var B=function(a,c,l,e){a.type="item";a[b.options.dataFields.id]||(a[b.options.dataFields.id]=f.getUniqueId());l&&(a[b.options.dataFields.pid]=l);l=v(a);b.isItemExpanded(a)&&a[b.options.dataFields.items]&&0<a[b.options.dataFields.items].length&&(l=l&&b.isThereVisibleChildren(a));l&&(0!=b.options.showStatusIcons&&
(c+=15),b.expandList.push(a),b.expandIndentList.push(c),b.expandParentList.push({parent:e}));return l},Da=function(a,c,l,e){if(!a[b.options.dataFields.items])return l=B(a,c+b.options.indent,l,e);if(l=B(a,c+b.options.indent,l,e)){e=0;var f;if(b.isItemExpanded(a)){var g=a[b.options.dataFields.items];if(g){b.applySorting(g);for(var k=0;k<g.length;k++)(f=Da(g[k],c+b.options.indent,a[b.options.dataFields.id],a))&&e++}}!b.isThereChildItems&&(0<e||!b.isItemExpanded(a)&&a[b.options.dataFields.items]&&0<a[b.options.dataFields.items].length&&
b.isThereVisibleChildren(a))&&(b.isThereChildItems=!0)}return l};this.expand=function(a){var c=b.getItemFromChildElem(document.activeElement);b.expandList.length=[];b.expandIndentList.length=[];b.expandParentList.length=[];if(!b.isItemExpanded(a)){var l=b.getItemCurrentIndex(a),h=b.getList(a);if(h){b.applySorting(h);for(var f=0;f<h.length;f++)Da(h[f],b.indentList[l],null,a)}if(0<b.expandList.length){b.allowEvents=!1;l++;Array.prototype.splice.apply(b.currentList,[l,0].concat(b.expandList));Array.prototype.splice.apply(b.indentList,
[l,0].concat(b.expandIndentList));Array.prototype.splice.apply(b.parentList,[l,0].concat(b.expandParentList));b.getItemScope()?b.updateView():b.updateLayout();var g=e(function(){b.updateViewSize();b.updateViewSize();b.updateScrollView();c&&b.updateFocus(c);b.allowEvents=!0;e.cancel(g)},1)}}};this.collapse=function(a){var c=b.getItemFromChildElem(document.activeElement);b.expandList.length=[];b.expandIndentList.length=[];if(b.isItemExpanded(a)){var l=null,h=!1,f=a,g=-1,k=b.getItemCurrentIndex(a);for(a=
b.getParent(a);a&&!h;){l=b.getList(a);for(g=l.indexOf(f)+1;!h&&g<l.length;)f=l[g],0<b.getItemCurrentIndex(f)&&(h=!0),g++;h||(f=a);a=b.getParent(a)}if(!h&&f)for(l=b.getList(),g=l.indexOf(f)+1;g<l.length;)if(f=l[g],0<b.getItemCurrentIndex(f)){h=!0;break}else g++;k++;l=b.currentList.length-k;h&&(l=b.getItemCurrentIndex(f)-k);if(0<l){b.currentList.splice(k,l);b.indentList.splice(k,l);b.parentList.splice(k,l);b.getItemScope()?b.updateView():b.updateLayout();var m=e(function(){b.updateViewSize();b.updateViewSize();
b.updateScrollView();c&&b.updateFocus(c);b.allowEvents=!0;e.cancel(m)},1)}}};this.toggle=function(a,c){if(a){if(a[b.options.dataFields.hasChildren]||a[b.options.dataFields.items]&&0!==a[b.options.dataFields.items].length)if(!c||!1===a[b.options.dataFields.expanded])if(!1!==c||!1!==a[b.options.dataFields.expanded]){var l=void 0!==c?c:!1!==a[b.options.dataFields.expanded]?!0:!1;!1!==(void 0!==c?c?b.callBeforeExpand(a):b.callBeforeCollapse(a):l?b.callBeforeCollapse(a):b.callBeforeExpand(a))&&(l=void 0!=
c?c:!l,l!=a[b.options.dataFields.expanded]&&(0!=l?b.expand(a):b.collapse(a),a[b.options.dataFields.expanded]=l),b.isItemExpanded(a)?b.callAfterExpand(a):b.callAfterCollapse(a))}}else{for(var l=b.getFullList(),e=0;e<l.length;e++)l[e][b.options.dataFields.expanded]=c;b.updateCurrentLayout()}};c.$on(c.name+"-collapse",function(a,c){b.toggle(c,!1)});c.$on(c.name+"-expand",function(a,c){b.toggle(c,!0)});c.$on(c.name+"-toggle",function(a,c){b.toggle(c)});this.filterParams=null;c.$on(c.name+"-filter",function(a,
c){b.filter(c)});this.filter=function(a){b.filterParams=a;b.updateCurrentLayout();b.callChange()};this.callGotFocus=function(a,b,l,e){angular.isDefined(c.events)&&c.events.gotFocus?c.events.gotFocus({event:a,item:b,edit:void 0!=l?!0:!1,editValue:e}):c.gotFocus({e:{event:a,item:b,edit:void 0!=l?!0:!1,editValue:e}})};this.callLostFocus=function(a,b,l,e){angular.isDefined(c.events)&&c.events.lostFocus?c.events.lostFocus({event:a,item:b,edit:void 0!=l?!0:!1,editValue:e}):c.lostFocus({e:{event:a,item:b,
edit:void 0!=l?!0:!1,editValue:e}})};this.getTabIndex=function(){return n[0].attributes&&n[0].attributes.tabindex?n[0].attributes.tabindex.value:""};this.updateFocus=function(a){if(1==b.options.allowFocus)var c=e(function(){if(a){var l=b.getElemFromItem(a);l&&(l=b.getElement(l))&&l[0].focus()}else n[0].focus();e.cancel(c)},5)};c.$on(c.name+"-focus",function(a,c){b.updateFocus(c)});var ka=!1;this.isItemExpanded=function(a){return a?a[b.options.dataFields.expanded]||void 0===a[b.options.dataFields.expanded]?
!0:!1:!0};this.getElement=function(a,b){var c=null;b||(b="content");if(a)for(var e=a.children(),f=0;f<e.length;f++){var g=angular.element(e.eq(f));if(g[0].attributes&&g[0].attributes["data-element"]&&g[0].attributes["data-element"].value===b){c=g;break}}return c};this.getElemFromItem=function(a){var c=null;if(a){a=b.getItemCurrentIndex(a);var e=n.find("li");if(e&&0<e.length)for(var h=0;h<e.length;h++){var f=angular.element(e[h]);if(f[0].attributes["data-index"]&&f[0].attributes["data-index"].value.toString()===
a.toString()){c=f;break}}}return c};this.getIndent=function(a){var c=0;if(a&&0<b.options.indent)for(parent=b.dataObj.getParent(a);parent;)c+=b.options.indent,parent=b.dataObj.getParent(parent);return c};this.getItemCurrentIndex=function(a){return a&&b.currentList?b.currentList.indexOf(a):-1};this.getObjCurrentIndex=function(a){return b.getItemCurrentIndex(a)};this.getObjState=function(a){if(a)switch(a.type){case "item":if(0==b.options.enabled||0==a[b.options.dataFields.enabled])return"disabled";if(1==
a.selected&&b.isObjInSelList(a))return"selected";if(a==b.hoverItem)return"hovered"}return"normal"};this.getItemFromChildElem=function(a){return a?(a=angular.element(a))?b.getItemFromElem(a[0].parentElement):null:null};this.getItemFromElem=function(a){if(a&&(a=angular.element(a))&&a[0].attributes["data-index"]&&(a=a[0].attributes["data-index"].value,b.isIndexInRange(a)))return b.currentList[a]};this.isIndexInRange=function(a){return 0<=a&&a<b.currentList.length};this.isItemEnabled=function(a){return a&&
1==b.options.enabled&&f.isEnabled(a[b.options.dataFields.enabled])};this.mouseButtonStatus=function(a){ka=a};c.$on(c.name+"-ensure-visible",function(a,c,e){b.ensureVisible(c,e)});c.$on(c.name+"-find-item-by-id",function(a,c){m.setTempData(b.findItemById(c))});c.$on(c.name+"-find-item-by-text",function(a,c){m.setTempData(b.findItemByText(c))});c.$on(c.name+"-get-full-path",function(a,c){m.setTempData(b.getFullPath(c))});c.$on(c.name+"-get-item-level",function(a,c){m.setTempData(b.getLevel(c))});c.$on(c.name+
"-get-item-parent",function(a,c){m.setTempData(b.getParent(c))});c.$on(c.name+"-get-item-at",function(a,c){c?m.setTempData(b.getItemAt(c.x,c.y)):m.setTempData(null)});c.$on(c.name+"-get-flat-list",function(a,c){c?m.setTempData(b.getFullList()):m.setTempData(b.currentList)});c.$on(c.name+"-get-list",function(a,c,e){1==e?m.setTempData(b.getFullList(c)):m.setTempData(b.getList(c))});this.ensureVisible=function(a,c){if(a){for(var l=[],h=b.getParent(a);h;)l.push(h),h=b.getParent(h);for(h=l.length-1;0<=
h;h--)l[h][b.options.dataFields.expanded]=!0;b.updateCurrentLayout();var f=e(function(){c=void 0!=c?c:"center";b.scrollTo(a,c);e.cancel(f)},100)}};this.findItemById=function(a){return b.dataObj.findObjectById(a)};this.findItemByText=function(a){return b.dataObj.findObjectByText(a)};this.getFullPath=function(a){var c="";if(a)for(c=a[b.options.dataFields.text],a=b.getParent(a);a;)c=[a[b.options.dataFields.text],b.options.pathSeparator,c].join(""),a=b.getParent(a);return c};this.getLevel=function(a){var b=
0;for(a=this.getParent(a);a;)b++,a=this.getParent(a);return b};this.getParent=function(a){return b.dataObj.getParent(a)};this.getList=function(a){return b.dataObj.getList(a)};this.getFirstItem=function(){for(var a=null,c=0;c<b.currentList.length;c++)if(b.isItemEnabled(b.currentList[c])){a=b.currentList[c];break}return a};this.getPrevItem=function(a){var c=null;if(0<=a&&a<b.currentList.length)for(--a;0<=a;a--)if(b.isItemEnabled(b.currentList[a])){c=b.currentList[a];break}return c};this.getNextItem=
function(a){var c=null;for(a+=1;a<b.currentList.length;a++)if(b.isItemEnabled(b.currentList[a])){c=b.currentList[a];break}return c};this.getLastItem=function(){for(var a=null,c=b.currentList.length-1;0<=c;c--)if(b.isItemEnabled(b.currentList[c])){a=b.currentList[c];break}return a};this.updateSelectionStatus=function(a){switch(a){case "shift":switch(b.options.selectionMode){case "multi-simple":b.multiSelection(!0);b.shiftKeyStatus(!1);break;case "multi-extended":b.multiSelection(!0);b.shiftKeyStatus(!0);
break;default:b.multiSelection(!1),b.shiftKeyStatus(!1)}break;case "ctrl":switch(b.options.selectionMode){case "multi-simple":b.multiSelection(!0);break;case "multi-extended":b.multiSelection(!0);break;default:b.multiSelection(!1)}}};n.bind("keydown",function(a){if(b.options.enabled)switch(a.keyCode){case 16:b.updateSelectionStatus("shift");break;case 17:b.updateSelectionStatus("ctrl");break;default:(a.ctrlKey||a.metaKey)&&b.updateSelectionStatus("ctrl"),a.shiftKey&&b.updateSelectionStatus("shift")}});
b.allowUpdate=!0;this.suspendLayout=function(){b.allowUpdate=!1};this.resumeLayout=function(){b.allowUpdate=!0;b.updateLayout()};c.$on(c.name+"-refresh",function(a,c,e){b.refresh(c,e)});c.$on(c.name+"-resume-layout",function(a){b.resumeLayout()});c.$on(c.name+"-suspend-layout",function(a){b.suspendLayout()});c.$on(c.name+"-update-layout",function(a){b.updateLayout()});c.$on(c.name+"-update-view",function(a){b.updateView()});c.$on(c.name+"-begin-load",function(a,c,e){c?(0>b.options.loadItems.indexOf(c)&&
b.options.loadItems.push(c),b.updateView()):b.beginLoad(e)});c.$on(c.name+"-end-load",function(a,c){b.endLoad(c)});this.callLoadComplete=function(){angular.isDefined(c.events)&&c.events.loadComplete?c.events.loadComplete():c.loadComplete()};this.callUpdateComplete=function(){angular.isDefined(c.events)&&c.events.updateComplete?c.events.updateComplete():c.updateComplete()};c.$on(c.name+"-get-scroll-pos",function(a){m.setTempData(b.getScrollPos())});c.$on(c.name+"-set-scroll-pos",function(a,c){b.setScrollPos(c)});
c.$on(c.name+"-scroll-to",function(a,c,e){b.scrollTo(c,e)});var aa=!1,ba=!1;this.shiftKeyStatus=function(a){if(void 0!=a)aa=a;else return aa};this.multiSelection=function(a){if(void 0!=a)ba=a;else return ba};this.isItemSelected=function(a){return f.isSelected(a)};this.clearPrevSelection=function(a){for(var c=0;c<b.options.selectedItems.length;c++)a&&!f.isEqual(b.options.selectedItems[c][b.options.dataFields.id],a[b.options.dataFields.id])?b.options.selectedItems[c].selected=!1:a||(b.options.selectedItems[c].selected=
!1);b.options.selectedItems.length=0;a&&b.isItemEnabled(a)&&b.options.selectedItems.push(a);b.refresh()};this.selectionCancelled=!1;this.itemSelection=function(a,e,l){if(e){if("none"!==b.options.selectionMode)if(b.isItemEnabled(e)){var h=b.itemSelection(),g=!0;h&&(g=!f.isEqual(h[b.options.dataFields.id],e[b.options.dataFields.id])||a&&(a.ctrlKey||a.metaKey));var k=!0,k=angular.isDefined(c.events)&&c.events.beforeSelect?c.events.beforeSelect({item:e}):c.beforeSelect({e:{item:e}});b.selectionCancelled=
0==k;if(0!=k)if(g){var m=a&&(a.shiftKey||a.ctrlKey||a.metaKey)?!0:!1,g=!0;"multi-extended"===b.options.selectionMode&&(g=!b.isObjInSelList(e));g&&("one"==b.options.selectionMode?b.clearPrevSelection():ka&&(aa||a&&a.shiftKey)?b.clearPrevSelection():ba||m||"multi-simple"===b.options.selectionMode||b.clearPrevSelection());b.options.selectedItem=e;if(ka&&(aa||a&&a.shiftKey)&&"one"!=b.options.selectionMode){if(a=b.getItemCurrentIndex(h),l=b.getItemCurrentIndex(e),a>l&&(h=a,a=l,l=h),b.isIndexInRange(a)&&
b.isIndexInRange(l))for(;a<=l;a++)b.currentList[a].selected=!0,b.options.selectedItems.push(b.currentList[a])}else ka&&(ba||m||"multi-simple"===b.options.selectionMode)?(a=null===e.selected||"undefined"===e.selected?!1:e.selected,e.selected=!a,e.selected?b.isObjInSelList(e)||b.options.selectedItems.push(e):b.options.selectedItems=b.options.selectedItems.filter(function(a){return a!=e})):(e.selected=!0,b.isObjInSelList(e)||b.options.selectedItems.push(e));angular.isDefined(c.selectedItem)&&(c.selectedItem=
e);b.callAfterSelect(e);b.refresh(null,null,!0)}else if(ba||m||"multi-simple"===b.options.selectionMode)a=null===e.selected||"undefined"===e.selected?!1:e.selected,l&&"undefined"!==l&&(a=l),e[b.options.dataFields.selected]=!a,e[b.options.dataFields.selected]?b.isObjInSelList(e)||b.options.selectedItems.push(e):b.options.selectedItems=b.options.selectedItems.filter(function(a){return a!=e}),b.callAfterSelect(e),b.refresh(null,null,!0)}else b.clearPrevSelection()}else return b.options.selectedItem};
this.updateSelection=function(a,c){var e=a&&(a.shiftKey||a.ctrlKey||a.metaKey)?!0:!1;!("multi-extended"==b.options.selectionMode&&0<b.options.selectedItems.length)||aa||a.shiftKey||ba||e||b.selectionCancelled||(b.clearPrevSelection(c),b.refresh(null,null,!0));b.selectionCancelled=!1};this.selectFirstItem=function(){for(var a=null,c=0;c<b.currentList.length;c++)if(b.isItemEnabled(b.currentList[c])){a=b.currentList[c];break}this.itemSelection(null,a);return b.options.selectedItem};this.isObjInSelList=
function(a){var c=!1,e=b.options.selectedItems;if(a&&e)for(var h=0;h<e.length;h++)if(f.isEqual(e[h][b.options.dataFields.id],a[b.options.dataFields.id])){c=!0;break}return c};this.getItemAt=function(a,c){var e,h,g=null,k=n.find("li");if(k&&0<k.length)for(var m=0;m<k.length;m++)if(e=angular.element(k[m]),h=f.getPageRect(e),f.checkHit(a,c,h)){g=b.getItemFromElem(e);break}return g};this.resetSelection=function(){switch(b.options.selectionMode){case "none":b.clearPrevSelection();break;default:b.clearPrevSelection(b.itemSelection())}};
c.$on(c.name+"-clear-selection",function(a){b.clearPrevSelection();b.options.selectedItem=null});c.$on(c.name+"-get-selected-item",function(a){m.setTempData(b.itemSelection())});c.$on(c.name+"-set-selected-item",function(a,c){var l=e(function(){b.itemSelection(null,c);e.cancel(l)},1)});c.$on(c.name+"-get-selected-items",function(a){m.setTempData(b.options.selectedItems)});c.$on(c.name+"-set-selected-items",function(a,c){c&&Array.isArray(c)&&e(function(){for(var a=b.options.selectedItems.length=0;a<
c.length;a++)c[a].selected=!0,b.options.selectedRows.push(c[a]);0<c.length?(b.options.selectedItem=c[c.length-1],b.callAfterSelect(b.options.selectedItem)):b.options.selectedItem=null;b.refresh(null,null,!0)},1)});c.$on(c.name+"-move-item",function(a,c,e,h,g){b.moveItem(c,e,h,g)});c.$watch("options",function(a,c){a!==c&&(b.updateOptions(a),b.updateLayout())},!0);c.$watch("allowDrag",function(a,c){a!==c&&(b.options.allowDrag=a,b.updateView())});c.$watch("allowDrop",function(a,c){a!==c&&(b.options.allowDrop=
a,b.updateView())});c.$watch("allowFocus",function(a,c){a!==c&&(b.options.allowFocus=a)});c.$watch("autoCheck",function(a,c){a!==c&&(b.options.autoCheck=a,b.updateView())});c.$watch("autoExpand",function(a,c){a!==c&&(b.options.autoExpand=a)});c.$watch("checkBoxSettings",function(a,c){a!==c&&b.updateCheckBoxSettings(a)});c.$watch("controlStyle",function(a,c){a!==c&&b.updateControlStyle(a)});c.$watch("editorSettings",function(a,c){a!==c&&b.updateEditorSettings(a)});c.$watch("enabled",function(a,c){a!==
c&&(b.options.enabled=a,b.updateView(),b.callEnabledChanged(a))});c.$watch("fields",function(a,c){a!==c&&(b.options.dataFields=a,b.UpdateData())});c.$watch("hoverSelection",function(a,c){a!==c&&(b.options.hoverSelection=a)});c.$watch("indent",function(a,c){a!==c&&(b.options.indent=a,b.updateLayout())});c.$watch("itemIcon",function(a,c){a!==c&&(b.options.itemIcon=a,b.updateLayout())});c.$watch("labelEdit",function(a,c){a!==c&&(b.options.labelEdit=a)});c.$watch("pathSeparator",function(a,c){a!==c&&
(b.options.pathSeparator=a)});c.$watch("rtl",function(a,c){a!==c&&(b.options.rtl=a,b.updateLayout())});c.$watch("selectionMode",function(a,c){a!==c&&(b.options.selectionMode=a,b.resetSelection())});c.$watch("showCheckBoxes",function(a,c){a!==c&&(b.options.showCheckBoxes=a,b.updateLayout())});c.$watch("showExpandBoxes",function(a,c){a!==c&&(b.options.showExpandBoxes=a,b.updateLayout())});c.$watch("showIcons",function(a,c){a!==c&&(b.options.showIcons=a,b.updateLayout())});c.$watch("showLines",function(a,
c){a!==c&&(b.options.showLines=a,b.updateLayout())});c.$watch("showStatusIcons",function(a,c){a!==c&&(b.options.showStatusIcons=a,b.updateLayout())});c.$watch("selectedItem",function(a,c){a!==c&&(c&&(c.selected=!1),b.options.selectedItem=a,b.callAfterSelect(a))});c.$watch("templateSettings",function(a,c){a!==c&&(b.updateTemplateSettings(a),b.updateLayout())});this.sortComparer=null;c.$watch("sorting",function(a,c){a!==c&&(b.options.sorting=a)});c.$on(c.name+"-sort",function(a,c,e){b.sort(c,e)});this.sort=
function(a,c){b.sortComparer=c;if("ascending"==a||"descending"==a||"none"==a)b.options.sorting=a;b.updateCurrentLayout();b.callChange()};this.isSortingAllowed=function(){return"ascending"==b.options.sorting||"descending"==b.options.sorting};this.applySorting=function(a){a&&(b.sortComparer?a.sort(b.sortComparer):b.isSortingAllowed()&&a.sort(function(a,c){var d,e;(d=a[b.options.dataFields.value])||(d=a[b.options.dataFields.text]);f.isObject(d)&&(d=d.value?d.value:d.text);(e=c[b.options.dataFields.value])||
(e=c[b.options.dataFields.text]);f.isObject(e)&&(e=e.value?e.value:e.text);d=void 0!=d?d:null;e=void 0!=e?e:null;switch(b.options.sorting){case "ascending":if(d<e)return-1;if(d>e)return 1;break;case "descending":if(d>e)return-1;if(d<e)return 1;break;default:return 0}}))};var Pa=function(a){if(a){var c=f.isFieldAvailable(a.general,"iui-checkbox");a=(a=a.box)?{general:f.isFieldAvailable(a.general,"iui-checkbox-box"),disabled:f.isFieldAvailable(a.disabled,"iui-checkbox-disabled"),checked:f.isFieldAvailable(a.checked,
"iui-checkbox-checked"),indeterminate:f.isFieldAvailable(a.indeterminate,"iui-checkbox-indeterminate"),unchecked:f.isFieldAvailable(a.unchecked,"iui-checkbox-unchecked")}:b.options.controlStyle.item.checkBox.box;return{general:c,box:a}}return b.options.controlStyle.item.checkBox};this.getExpandBoxStyle=function(a){return a?{general:f.isFieldAvailable(a.general,"iui-treeview-expand-box"),animated:f.isFieldAvailable(a.animated,"iui-treeview-expand-box-load"),expanded:f.isFieldAvailable(a.expanded,"iui-treeview-expand-box-open"),
collapsed:f.isFieldAvailable(a.collapsed,"iui-treeview-expand-box-close")}:b.options.controlStyle.item.expandBox};var Sa=function(a){if(a){var c;c=a.general;c=f.isString(c)?c:c?{disabled:f.isFieldAvailable(c.disabled,"iui-treeview-item-disabled"),focused:f.isFieldAvailable(c.focused,"iui-treeview-item-focused"),normal:f.isFieldAvailable(c.normal,"iui-treeview-item"),hovered:f.isFieldAvailable(c.hovered,"iui-treeview-item-hovered"),selected:f.isFieldAvailable(c.selected,"iui-treeview-item-selected")}:
b.options.controlStyle.item.general;var e=Pa(a.checkBox),g=b.getExpandBoxStyle(a.expandBox);a=a.content;a=f.isString(a)?a:a?{disabled:f.isFieldAvailable(a.disabled,"iui-treeview-item-content-disabled"),focused:f.isFieldAvailable(a.focused,"iui-treeview-item-content-focused"),normal:f.isFieldAvailable(a.normal,"iui-treeview-item-content"),hovered:f.isFieldAvailable(a.hovered,"iui-treeview-item-content-hovered"),selected:f.isFieldAvailable(a.selected,"iui-treeview-item-content-selected")}:b.options.controlStyle.item.content;
return{general:c,checkBox:e,expandBox:g,content:a}}return b.options.controlStyle.item};this.updateControlStyle=function(a){b.options.controlStyle=a?{general:f.isFieldAvailable(a.general,"iui-treeview"),item:Sa(a.item)}:{general:f.isFieldAvailable(b.defaultStyle.general,"iui-treeview"),item:Sa(b.defaultStyle.item)}};this.getCurrentItemStyle=function(a,c){var e=b.options.controlStyle.item;if(a)switch(a.style){case "initial":break;case "parent":return b.getCurrentItemStyle(b.getParent(a),c);default:null!=
a.style&&(e=a.style)}if(c){if(f.isString(e.general))return e.general;switch(c){case "disabled":return e.general&&e.general.disabled?e.general.disabled:b.options.controlStyle.item.general.disabled;case "focused":return e.general&&e.general.focused?e.general.focused:b.options.controlStyle.item.general.focused;case "hovered":return e.general&&e.general.hovered?e.general.hovered:b.options.controlStyle.item.general.hovered;case "selected":return e.general&&e.general.selected?e.general.selected:b.options.controlStyle.item.general.selected;
default:return e.general&&e.general.normal?e.general.normal:b.options.controlStyle.item.general.normal}}else return e?e:b.options.controlStyle.item};this.getCurrentItemContentStyle=function(a,c){var e=b.options.controlStyle.item.content;if(a)switch(a.style){case "initial":break;case "parent":return b.getCurrentItemContentStyle(b.getParent(a),c);default:null!=a.style&&a.style.content&&(e=a.style.content)}if(c){if(f.isString(e))return e;switch(c){case "disabled":return e&&e.disabled?e.disabled:b.options.controlStyle.item.content.disabled;
case "focused":return e&&e.focused?e.focused:b.options.controlStyle.item.content.focused;case "hovered":return e&&e.hovered?e.hovered:b.options.controlStyle.item.content.hovered;case "selected":return e&&e.selected?e.selected:b.options.controlStyle.item.content.selected;default:return e&&e.normal?e.normal:b.options.controlStyle.item.content.normal}}else return e?e:b.options.controlStyle.item.content}}]).directive("iuiTreeview",["$compile","$timeout","$interval","IntegralUIInternalService","IntegralUIDragDrop",
"$window",function(c,n,e,g,p,f){return{restrict:"EA",controller:"IntegralUITreeViewController",transclude:!0,replace:!0,template:'<div class="iui-treeview" data-element="treeview"><ul class="iui-treeview-block"></ul></div>',scope:{allowAnimation:"=",allowDrag:"=",allowDrop:"=",allowFocus:"=",animationSpeed:"=",autoCheck:"=",autoExpand:"=",checkboxSettings:"=",controlStyle:"=",editorSettings:"=",enabled:"=",fields:"=",hoverSelection:"=",itemIcon:"=",indent:"=",items:"=",labelEdit:"=",name:"@",options:"=?",
pathSeparator:"@",rtl:"=",selectedIndex:"=",selectedItem:"=",selectionMode:"@",showCheckBoxes:"=",showExpandBoxes:"=",showIcons:"=",showLines:"=",showStatusIcons:"=",sorting:"@",templateSettings:"=",afterCollapse:"&",afterEdit:"&",afterExpand:"&",afterLabelEdit:"&",afterSelect:"&",beforeCollapse:"&",beforeEdit:"&",beforeExpand:"&",beforeLabelEdit:"&",beforeSelect:"&",change:"&",clear:"&",dragDrop:"&",dragEnter:"&",dragLeave:"&",dragOver:"&",enabledChanged:"&",events:"=?",itemAdded:"&",itemAdding:"&",
itemCheckedChanging:"&",itemCheckedChanged:"&",itemCheckstateChanging:"&",itemCheckstateChanged:"&",itemClick:"&",itemDblclick:"&",itemHover:"&",loadComplete:"&",gotFocus:"&",keyDown:"&",keyPress:"&",keyUp:"&",lostFocus:"&",itemRemoved:"&",itemRemoving:"&",itemRightclick:"&",scrollposChanged:"&",selectionChanged:"&",updateComplete:"&"},link:function(k,m,P,a,b){var u=this,x=m.children().eq(0),y=angular.element('<div class="iui-scrollbar-vertical"><div class="iui-scroll-button-thumb-vertical"></div></div>'),
v=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),K=angular.element('<div class="iui-scrollbar-corner"></div>'),T=null,Q=null,Z=null,w=a.getEditBox(),Ra=function(){var b="iui-treeview-block";a.options.rtl&&(b+=" "+b+"-rtl");return b};k.$on("$destroy",function(a){u.s2t();V&&(n.cancel(V),V=null);m.unbind("click dblclick dragenter dragleave dragend drop keydown mousedown mouseleave mousemove mousewheel scroll touchstart touchmove touchend");
angular.element(f).unbind("dragenter",gb);angular.element(f).unbind("dragover",hb);angular.element(f).unbind("dragend",ib);angular.element(f).unbind("keyup",jb);angular.element(f).unbind("mousemove",kb);angular.element(f).unbind("mouseup",lb);w&&w.unbind("blur focus keydown mousedown");aa();t&&t.$destroy()});m.append(a.getDropMarkWindow());a.dropMark();var ja=function(){T&&(n.cancel(T),T=null)};a.addDropMark=function(){var b;b=m[0];for(var c=null;b;){if(b===document.getElementsByTagName("body")[0]){c=
b;break}b=b.offsetParent}if(b=c)angular.element(b).append(a.getDropMarkWindow()),a.dropMark()};a.removeDropMark=function(){a.getDropMarkWindow().remove()};var Ca=function(b,c){a.labelEditStatus()&&a.closeEditor();b.preventDefault();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var e=a.getItemFromChildElem(c);if(e){var d=c[0].getBoundingClientRect(),r=bb(),F=a.getMousePos(b);
F.x-=d.left+r.x;F.y-=d.top+r.y;var r=p.getDropPos(F,{x:0,y:0,width:c[0].offsetWidth,height:c[0].offsetHeight}),F=p.getData(),d=a.isDropAllowed(F.source,e,r),g={event:b,sourceTree:F.sourceCtrl?F.sourceCtrl.getCtrlName():"",dragItem:F.source,targetTree:a.getCtrlName(),targetItem:e,isDropAllowed:d,dropPos:r,mousePos:a.getMousePos(b)},g=a.callDragOver(g);if(d&&0!=g){var f=a.getMousePos(b),g=f.y+16,f=f.x+20,h=a.getDropMarkWindow();h.empty();var k="iui-drop-marker-move-in";switch(r){case 1:k="iui-drop-marker-move-up";
break;case 2:k="iui-drop-marker-move-down"}h.append("<span class='"+k+"'></span><span class='iui-drop-marker-title'>"+e[a.options.dataFields.text]+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:g,left:f});a.dropMark(d);p.setData({source:F.source,sourceList:F.sourceList,target:e,dropPos:r})}else b.dataTransfer?b.dataTransfer.dropEffect="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect="none"),a.dropMark()}}},U=function(b,c){b.preventDefault();
ja();a.dropMark();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var e=a.getItemFromChildElem(c);if(e){var r=p.getData(),F=r.source;F||(F=a.getDnDSource(b));(d=a.isDropAllowed(F,e,r.dropPos))&&F&&(d={event:b,sourceTree:r.sourceCtrl?r.sourceCtrl.getCtrlName():"",dragItem:F,targetTree:a.getCtrlName(),targetItem:e,isDropAllowed:d,dropPos:r.dropPos,mousePos:a.getMousePos(b)},
!1!==a.callDragDrop(d)&&(a.drop(r),k.$$phase||k.$apply()))}}p.clearData();a.dragDropStatus(!1);b.stopPropagation()},B=angular.element('<div style="opacity:0.75;position:absolute;z-index:999"></div>'),Da=function(){B&&(B.remove(),B.css("top","-9999999px"),B.css("left","-9999999px"))},ka=function(b){var c="";if(a.options.showExpandBoxes){var d=a.defaultStyle.item.expandBox.general;b[a.options.dataFields.style]&&b[a.options.dataFields.style].expandBox&&b[a.options.dataFields.style].expandBox.general!=
d?d+=" "+b[a.options.dataFields.style].expandBox.general:a.options.controlStyle.item.expandBox.general!=d&&(d+=" "+a.options.controlStyle.item.expandBox.general);var e=a.getCurrentItemStyle(b),e=a.getExpandBoxStyle(e.expandBox);if(a.isThereChildItems||b&&b[a.options.dataFields.hasChildren])c=d;b&&(b[a.options.dataFields.hasChildren]||b[a.options.dataFields.items]&&0<b[a.options.dataFields.items].length&&a.isThereVisibleChildren(b))&&(0<=a.options.loadItems.indexOf(b)?c+=" "+e.animated:(c=b[a.options.dataFields.hasChildren]&&
void 0===b[a.options.dataFields.expanded]?c+(" "+e.expanded):0!=b[a.options.dataFields.expanded]?c+(" "+e.collapsed):c+(" "+e.expanded),!0===a.options.rtl&&(c+="-rtl"),a.options.enabled&&a.isItemEnabled(b)||(c+="-disabled")))}return c},aa=function(){var b=x.find("li");if(0<b.length)for(var c=0;c<b.length;c++){currentElem=angular.element(b[c]);currentElem.unbind("dragover drop dragenter dragleave dragend");var d=a.getElement(currentElem,"expandbox");d&&d.unbind("click dblclick touchend");(d=a.getElement(currentElem))&&
d.unbind("blur click dragstart dragover drop dragenter dragleave dragend dblclick focus keydown keypress keyup mouseenter mouseleave mousedown mouseup touchstart touchmove touchend")}},ba=function(){var b=x.find("li");if(0<b.length){var c,e=b.length-1,mb="content";a.getTemplateUrl()&&(mb="template-content");for(var r=0;r<=e;r++)c=angular.element(b[r]),Pa(c),Sa(a.getElement(c,"expandbox")),d(a.getElement(c,"icon")),Eb(a.getElement(c,mb))}},Pa=function(b){b&&(b.bind("dragover",function(b){var c=a.getItemFromElem(this);
if(c&&a.isItemEnabled(c)){if(a.isScrollBarVisible("vertical")){var c=a.getMousePos(b),d=m[0].getBoundingClientRect();c.x-=angular.element(f)[0].pageXOffset;c.y-=angular.element(f)[0].pageYOffset;c.y<d.top+40?Ta(b,!1):c.y>d.bottom-40?Ta(b,!0):la()}else la();b.stopPropagation()}}),b.bind("dragend",function(b){var c=a.getItemFromElem(this);c&&a.isItemEnabled(c)&&(b.preventDefault(),a.dragDropStatus(!1),a.dropMark(),p.getData().source||p.clearData())}))},Sa=function(b){b&&(b.bind("dblclick",function(b){var c=
angular.element(this);(c=a.getItemFromChildElem(c))&&a.isItemEnabled(c)&&(a.toggle(c),b.stopPropagation())}),b.bind("click",function(b){var c=angular.element(this);(c=a.getItemFromChildElem(c))&&a.isItemEnabled(c)&&(a.toggle(c),b.stopPropagation())}),b.bind("touchend",function(b){b.preventDefault();var c=angular.element(this);(c=a.getItemFromChildElem(c))&&a.isItemEnabled(c)&&(a.toggle(c),b.stopPropagation())}))},d=function(b){b&&(b.bind("dragover",function(b){var c=a.getItemFromChildElem(this);c&&
a.isItemEnabled(c)&&Ca(b,angular.element(this))}),b.bind("drop",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&U(b,angular.element(this))}))};a.dragIcon=document.createElement("img");a.dragIcon.width=1;var J={x:0,y:0},l={x:0,y:0},h=!1,ab=!1,Y=null,bb=function(){return{x:angular.element(f)[0].pageXOffset,y:angular.element(f)[0].pageYOffset}},qa=function(a){var b=bb();return{x:a.x-b.x,y:a.y-b.y}},Eb=function(b){if(b){b.bind("dragstart",function(b){var c=a.getItemFromChildElem(this);
if(c&&a.isItemEnabled(c))if(c=angular.element(this),a.labelEditStatus())b.preventDefault();else{document.activeElement&&document.activeElement.blur();p.clearData();if(c=a.getItemFromChildElem(c))if(Qa(),a.isDragAllowed(c)){a.dragDropStatus(!0);a.addDropMark();b.dataTransfer?(b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text",c[a.options.dataFields.id]?c[a.options.dataFields.id].toString():"")):b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed=
"move",b.originalEvent.dataTransfer.setData("text",c[a.options.dataFields.id]?c[a.options.dataFields.id].toString():""));c={source:c,sourceCtrl:a,sourceCollection:a.dataObj};switch(a.options.selectionMode){case "multi-simple":c.source=a.options.selectedItems;break;case "multi-extended":c.source=a.options.selectedItems}p.setData(c)}else b.dataTransfer?b.dataTransfer.effectAllowed="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="none");b.stopPropagation()}});
b.bind("dragover",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&Ca(b,angular.element(this))});b.bind("drop",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&U(b,angular.element(this))});b.bind("dragenter",function(b){b.preventDefault();var c=angular.element(this),d=a.getItemFromChildElem(c);if(d&&a.isItemEnabled(d)&&(Ea||(a.hoverItem=d,a.refresh(d)),a.options.autoExpand))var q=n(function(){T||(T=n(function(){T&&a.toggle(d,!0)},750));n.cancel(q)},1);c=p.getData();
c.source||(c.source=a.getDnDSource(b));c={event:b,sourceTree:c.sourceCtrl?c.sourceCtrl.getCtrlName():"",dragItem:c.source,targetTree:a.getCtrlName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragEnter(c);b.stopPropagation()});b.bind("dragleave",function(b){b.preventDefault();a.hoverItem=null;var c=angular.element(this);(c=a.getItemFromChildElem(c))&&a.isItemEnabled(c)&&a.refresh(c);ja();c=p.getData();c.source||(c.source=a.getDnDSource(b));c={event:b,sourceTree:c.sourceCtrl?c.sourceCtrl.getCtrlName():
"",dragItem:c.source,targetTree:a.getCtrlName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragLeave(c);b.stopPropagation()});b.bind("dragend",function(b){(b=a.getItemFromChildElem(this))&&a.isItemEnabled(b)&&a.dragDropStatus(!1)});b.bind("touchstart",function(b){var c=a.getItemFromChildElem(this);if(c&&a.isItemEnabled(c)&&(b.preventDefault(),(c=a.getTouchData(b))&&0<c.length)){ab=!0;var d=n(function(){ab=!1;n.cancel(d)},750);J=qa({x:c[0].pageX,y:c[0].pageY});a.mouseButtonStatus(!0);c=J;
if((c=a.getItemAt(c.x,c.y))&&a.isItemEnabled(c)){var q=angular.element(this);a.itemSelection(b,c);Y=c;q[0].focus();a.changeCheckValue(c);"click"==a.options.editorSettings.activate&&Ba(b,angular.element(this))}}});b.bind("touchmove",function(b){var c,d,q=a.getItemFromChildElem(this);if(q&&a.isItemEnabled(q)&&(q=a.getTouchData(b))&&0<q.length){l=qa({x:q[0].pageX,y:q[0].pageY});var q=Math.abs(l.x-J.x),e=Math.abs(l.y-J.y),M=m[0].getBoundingClientRect();if(p.hitTest(l.x,l.y,M)){if(b.preventDefault(),B&&
B.css("display","block"),!ab)if(!h&&(2<q||2<e)&&Y&&a.isItemEnabled(Y))if(angular.element(this),a.labelEditStatus())b.preventDefault();else{h=!0;p.clearData();if((q=a.getTouchData(b))&&0<q.length&&(qa({x:q[0].pageX,y:q[0].pageY}),Y&&(Qa(),a.isDragAllowed(Y)))){a.dragDropStatus(!0);a.addDropMark();q={source:Y,sourceCtrl:a,sourceCollection:a.dataObj};switch(a.options.selectionMode){case "multi-simple":q.source=a.options.selectedItems;break;case "multi-extended":q.source=a.options.selectedItems}p.setData(q);
if(q=a.getElemFromItem(Y))if(q=a.getElement(q))B.empty(),B.append(q.clone()),B.css("display","none"),m.append(B)}b.stopPropagation()}else if(h){angular.element(this);a.labelEditStatus()&&a.closeEditor();b.preventDefault();if((q=a.getTouchData(b))&&0<q.length){var M=bb(),L=qa({x:q[0].pageX,y:q[0].pageY});if(q=a.getItemAt(L.x,L.y)){if(e=a.getElemFromItem(q)){var g=e[0].getBoundingClientRect(),g=p.getDropPos({x:L.x-g.left,y:L.y-g.top},{x:0,y:0,width:e[0].offsetWidth,height:e[0].offsetHeight}),e=p.getData(),
f=a.isDropAllowed(e.source,q,g),n={event:b,sourceTree:e.sourceCtrl?e.sourceCtrl.getCtrlName():"",dragItem:e.source,targetTree:a.getCtrlName(),targetItem:q,isDropAllowed:f,dropPos:g,mousePos:L},n=a.callDragOver(n);d=m[0].getBoundingClientRect();c=L.x-d.left;d=L.y-d.top;B.css("top",d-16+"px");B.css("left",c+"px");B.css("display","block");if(f&&0!=n){c=L;L=c.y+M.y+16;M=c.x+M.x+20;c=a.getDropMarkWindow();c.empty();d="iui-drop-marker-move-in";switch(g){case 1:d="iui-drop-marker-move-up";break;case 2:d=
"iui-drop-marker-move-down"}c.append("<span class='"+d+"'></span><span class='iui-drop-marker-title'>"+q[a.options.dataFields.text]+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:L,left:M});a.dropMark(f);p.setData({source:e.source,sourceList:e.sourceList,target:q,dropPos:g})}else a.dropMark()}}else q=p.getData(),e={source:q.source,sourceCtrl:q.sourceCtrl,target:null,dropPos:-1},p.setData(e),n={event:b,sourceTree:q.sourceCtrl?q.sourceCtrl.getCtrlName():"",dragItem:q.source,targetTree:a.getCtrlName(),
targetItem:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:L},d=m[0].getBoundingClientRect(),c=L.x-d.left,d=L.y-d.top,B.css("top",d-16+"px"),B.css("left",c+"px"),n=a.callDragOver(n),0==n?a.dropMark():(c=L,L=c.y+16,M=c.x+20,c=a.getDropMarkWindow(),c.empty(),c.append("<span class='iui-drop-marker-move-end'></span><span class='iui-drop-marker-title'>"+(k.name?k.name:"TreeView")+"</span>"),a.updateDropMarkElem(a.getDropMarkWindow(),{top:L,left:M}),a.dropMark(!0))}b.stopPropagation()}}else b.preventDefault(),
a.dropMark(),a.cancelScrollTimer(),B&&B.css("display","none")}});b.bind("touchend",function(b){var c=a.getItemFromChildElem(this);if(c&&a.isItemEnabled(c)){if((c=a.getTouchData(b))&&0<c.length){var c=qa({x:c[0].pageX,y:c[0].pageY}),d=m[0].getBoundingClientRect();if(p.hitTest(c.x,c.y,d))if(h){angular.element(this);b.preventDefault();ja();a.dropMark();Da();if((c=a.getTouchData(b))&&0<c.length){var d=qa({x:c[0].pageX,y:c[0].pageY}),q=a.getItemAt(d.x,d.y);if(q){var c=p.getData(),e=c.source,M=a.isDropAllowed(e,
q,c.dropPos);M&&e&&(d={event:b,sourceTree:c.sourceCtrl?c.sourceCtrl.getCtrlName():"",dragItem:e,targetTree:a.getCtrlName(),targetItem:q,isDropAllowed:M,dropPos:c.dropPos,mousePos:d},d=a.callDragDrop(d),!1!==d&&(a.drop(c),k.$$phase||k.$apply()))}else c=p.getData(),c.source&&(d={event:b,sourceTree:c.sourceCtrl?c.sourceCtrl.getCtrlName():"",dragItem:c.source,targetTree:a.getCtrlName(),targetItem:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:d},d=a.callDragDrop(d),!1!==d&&(a.drop(c),k.$$phase||
k.$apply())),p.clearData()}p.clearData();a.dragDropStatus(!1);b.stopPropagation()}else a.mouseButtonStatus(!1),(c=a.getItemAt(c.x,c.y))&&a.updateSelection(b,c),Qa()}c=h;a.removeDropMark();Da();l={x:0,y:0};h=!1;Y=null;c&&b.stopPropagation()}});b.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=a.getItemFromChildElem(this);if(c){var d="dblclick"==a.options.editorSettings.activate;d&&Ba(b,angular.element(this),0);0==a.callItemDblClick(c,a.getMousePos(b))||d||a.toggle(c)}}b.stopPropagation()});
b.bind("mouseenter",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&(angular.element(this),a.hoverItem=c,a.refresh(c),a.callItemHover(c),a.options.hoverSelection&&(Z=n(function(){Z&&a.itemSelection(b,c)},500)))});b.bind("mouseleave",function(b){a.hoverItem=null;(b=a.getItemFromChildElem(this))&&a.isItemEnabled(b)&&a.refresh(b);Z&&(n.cancel(Z),Z=null)});var c=function(b,c){b.preventDefault();focusDelayTime=0;var d=a.getItemCurrentIndex(c),q=G+ca-2,q=q<a.currentList.length-1?q:
a.currentList.length-1;d===q&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(m[0].clientHeight/4)}),focusDelayTime=1);var e=a.getNextItem(d);if(e){a.itemSelection(b,e);k.$apply();var M=n(function(){a.updateFocus(e);n.cancel(M)},focusDelayTime)}},d=function(b,c){b.preventDefault();focusDelayTime=0;var d=a.getItemCurrentIndex(c),q=G;d===(0<q?q:0)&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-Math.floor(m[0].clientHeight/4)}),focusDelayTime=1);var e=a.getPrevItem(a.getItemCurrentIndex(c));
if(e){a.itemSelection(b,e);k.$apply();var M=n(function(){a.updateFocus(e);n.cancel(M)},focusDelayTime)}};b.bind("keydown",function(e){var r=a.getItemFromChildElem(this);if(r&&a.isItemEnabled(r)){a.callKeyDown(e,r);var f=0;switch(e.keyCode){case 9:f=a.currentList.length;0<f&&(e.shiftKey?g.isEqual(r[a.options.dataFields.id],a.currentList[0][a.options.dataFields.id])||d(e,r):g.isEqual(r[a.options.dataFields.id],a.currentList[f-1][a.options.dataFields.id])||c(e,r));break;case 13:Ba(e,b,0);break;case 16:a.updateSelectionStatus(e,
"shift");break;case 17:a.updateSelectionStatus(e,"ctrl");break;case 33:e.preventDefault();f=a.getItemCurrentIndex(r);r=f-ca;r=0<r?r:0;if(r!==f){var f=1,h=a.getPrevItem(r+1);if(h){a.scrollTo(h);a.itemSelection(e,h);k.$apply();var l=n(function(){a.updateFocus(h);n.cancel(l)},f)}}break;case 34:e.preventDefault();f=a.getItemCurrentIndex(r);r=f+ca;r=r<a.currentList.length-1?r:a.currentList.length-1;r!==f&&(f=1,h=a.getNextItem(r-1))&&(a.scrollTo(h,"bottom"),a.itemSelection(e,h),k.$apply(),l=n(function(){a.updateFocus(h);
n.cancel(l)},f));break;case 35:e.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:D.y});var m=a.getLastItem();m&&(a.itemSelection(e,m),l=n(function(){a.updateFocus(m);n.cancel(l)},1));break;case 36:e.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:0});var p=a.getFirstItem();p&&(a.itemSelection(e,p),l=n(function(){a.updateFocus(p);n.cancel(l)},1));break;case 37:e.preventDefault();r[a.options.dataFields.items]&&0<r[a.options.dataFields.items].length&&(a.toggle(r,!1),a.updateFocus(r));break;case 32:e.preventDefault();
a.itemSelection(e,r,r.selected);k.$apply();break;case 38:d(e,r);break;case 39:e.preventDefault();r[a.options.dataFields.items]&&0<r[a.options.dataFields.items].length&&(a.toggle(r,!0),a.updateFocus(r));break;case 40:c(e,r);break;default:(e.ctrlKey||e.metaKey)&&a.updateSelectionStatus(e,"ctrl"),e.shiftKey&&a.updateSelectionStatus(e,"shift")}}});b.bind("keyup",function(b){var c=a.getItemFromChildElem(this);if(c&&a.isItemEnabled(c)){switch(b.keyCode){case 16:a.multiSelection(!1);a.shiftKeyStatus(!1);
break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||(a.multiSelection(!1),a.shiftKeyStatus(!1))}a.callKeyUp(b,c)}});b.bind("keypress",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&a.callKeyPress(b,c)});b.bind("click",function(b){if(1===b.which){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&a.callItemClick(b,c,a.getMousePos(b))}b.stopPropagation()});b.bind("mousedown",function(b){var c=a.getItemFromChildElem(this);
if(c&&a.isItemEnabled(c)){a.mouseButtonStatus(!0);a.itemSelection(b,c);switch(b.which){case 1:a.changeCheckValue(c);"click"==a.options.editorSettings.activate&&Ba(b,angular.element(this));break;case 3:a.callItemRightClick(c,a.getMousePos(b))}b.stopPropagation()}});b.bind("mouseup",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&(a.mouseButtonStatus(!1),a.updateSelection(b,c),1===b.which&&Qa())});b.bind("focus",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&
a.callGotFocus(b,c)});b.bind("blur",function(b){var c=a.getItemFromChildElem(this);c&&a.isItemEnabled(c)&&a.callLostFocus(b,c)})}};a.openEditor=function(b){if(b){var c=a.getElemFromItem(b);c&&0!=b[a.options.dataFields.allowEdit]&&(b=a.getElement(c))&&Ba(null,b,0)}};a.closeEditor=function(b){b?(b=a.getElemFromItem(b))&&(b=a.getElement(b))&&sa(null,b,!1):sa(null,null,!1)};var Ba=function(b,c,d){a.options.labelEdit&&(void 0===d&&(d=500),Q=n(function(){if(Q)var a=n(function(){sa(b,c,!0);n.cancel(a)},
d);n.cancel(Q)},d/3))},Qa=function(){Q&&(n.cancel(Q),Q=null)},ra=null,sa=function(b,c,d){if(a.dragDropStatus())d=w[0].value,a.labelEditStatus(!1),w.unbind("blur focus keydown mousedown"),w.remove(),ra=null;else{var e=a.getItemFromChildElem(c);if(e)if(c&&e[a.options.dataFields.text]&&""!=e[a.options.dataFields.text]&&c.css("height","auto"),d){if(d="",0!=a.callBeforeLabelEdit(e)){ra=e;a.labelEditStatus(!0);w.unbind("blur focus keydown mousedown");m.append(w);e[a.options.dataFields.text]&&""!=e[a.options.dataFields.text]||
(b=g.getMargin(c[0].parentElement),d=g.getPadding(c[0]),c.css("height",z-(b.top+b.bottom+2)-(d.top+d.bottom)+"px"));d=m[0].getBoundingClientRect();var f=c[0].getBoundingClientRect();b=c[0].offsetHeight-4;d=f.top-d.top-1;var f=a.scrollPos.x+c[0].offsetLeft,h=m[0].clientWidth-c[0].offsetLeft-6;C&&(h-=16);a.updateEditBox({top:d,left:f,width:h,height:b});w[0].value=e[a.options.dataFields.text];w.bind("keydown",function(b){switch(b.keyCode){case 13:e[a.options.dataFields.text]=w[0].value?w[0].value:"null";
sa(b,c,!1);break;case 27:sa(b,c,!1)}b.stopPropagation()});w.bind("focus",function(b){var c=angular.element(this);a.callGotFocus(b,ra,!0,c[0].value)});w.bind("blur",function(a){sa(a)});w.bind("mousedown",function(a){a.stopPropagation()});var k=n(function(){w[0].focus();w[0].select();n.cancel(k)},10)}}else d=w[0].value,a.labelEditStatus(!1),w.unbind("blur focus keydown mousedown"),w.remove(),a.updateView(),a.updateFocus(e),a.callAfterLabelEdit(e),a.callLostFocus(b,e,!0,d),ra=null;else d=w[0].value,
a.labelEditStatus(!1),w.unbind("blur focus keydown mousedown"),w.remove(),a.callAfterLabelEdit(),a.updateView(),a.callLostFocus(b,ra,!0,d),ra=null}},nb=function(b){var c="";b[a.options.dataFields.icon]?c=b[a.options.dataFields.icon]:a.options.itemIcon&&(c=a.options.itemIcon);return c},ob=function(b){return"iui-treeview-status-icon "+b[a.options.dataFields.statusIcon]},pb=function(b){return b?b[a.options.dataFields.icon]||a.options.itemIcon:!1},G=0,t=null,A=100,z=0,W=0,ca=0,N=0,ma=0,Fa=!1,ta=!1,Ga=
9,Ha=9,Ua=0,da=0,na=0,Ia=1,Va=0,Ja=0,ea=0,ua=0,Wa=1,H=null,I=null,E=!1,C=!1;this.scrollMousePos=null;var D={x:0,y:0},Ja=0;k.verScrollVisibility=!1;k.$watch("verScrollVisibility",function(b,c){b!=c&&a.updateCurrentLayout()});a.updateViewSize=function(){var b=n(function(){W=0;C=E=!1;a.getTemplateUrl()||a.updateLongestItem();if(!a.getTemplateUrl()&&a.longestItem&&0<a.currentList.length){var c=a.getItemCurrentIndex(a.longestItem),c=angular.element(Fb(c,!0));m.append(c);W=c[0].offsetWidth;var d=m[0].offsetWidth-
6;C&&y&&(d-=y[0].offsetWidth);W>d&&(v.unbind("click mousedown"),m.append(v),v.bind("click",function(a){a.stopPropagation()}),v.bind("mousedown",function(b){if(a.options.enabled){b=g.getClientMousePos(b,this);var c=Math.floor(m[0].clientWidth);H&&(b.x<H[0].offsetLeft?a.setScrollPos({x:a.scrollPos.x-c,y:a.scrollPos.y}):b.x>H[0].offsetLeft+H[0].offsetWidth&&a.setScrollPos({x:a.scrollPos.x+c,y:a.scrollPos.y}))}}),H=angular.element(v.children().eq(0)),E=!0,H.bind("mousedown",function(b){a.options.enabled&&
1===b.which&&(u.scrollMousePos=a.getMousePos(b),Fa=!0);b.stopPropagation()}));c.remove()}k.verScrollVisibility=!1;0<a.currentList.length&&(c=m[0].offsetHeight-6,E&&v&&(c-=v[0].offsetHeight),d=(va.top+va.bottom)/2,A=0<z?Math.floor(c/(z+d))+1:100,A<a.currentList.length+1&&(y.unbind("click mousedown mouseup"),m.append(y),y.bind("click",function(a){a.stopPropagation()}),y.bind("mousedown",function(b){if(a.options.enabled&&1==b.which){var c=g.getClientMousePos(b,this),d=Math.floor(m[0].clientHeight);I&&
(c.y<I[0].offsetTop?(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-d}),Ta(b,!1,d)):c.y>I[0].offsetTop+I[0].offsetHeight&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+d}),Ta(b,!0,d)))}}),y.bind("mouseup",function(b){a.cancelScrollTimer()}),I=angular.element(y.children().eq(0)),C=!0,I.bind("mousedown",function(b){a.options.enabled&&1===b.which&&(u.scrollMousePos=a.getMousePos(b),ta=!0);b.stopPropagation()})));E||(v.unbind("mousedown"),v.remove(),D.x=0);C||(y.unbind("mousedown"),y.remove(),D.y=
0);E&&C?m.append(K):K.remove();n.cancel(b);!E&&0<a.scrollPos.x&&a.setScrollPos({x:0,y:a.scrollPos.y});!C&&0<a.scrollPos.y&&a.setScrollPos({x:a.scrollPos.x,y:0})},1)};a.updateScrollView=function(){qb()};var qb=function(){var b=n(function(){N=m[0].offsetWidth-6;ma=m[0].offsetHeight-6;ma=E?ma-v[0].offsetHeight:ma-4;N=C?N-y[0].offsetWidth:N-4;N<W?x.css("width",W+"px"):x.css("width",N+"px");x.css("height",ma+"px");E&&(v.css("bottom","0px"),C||(N+=3),v.css("width",N+1+"px"));C&&(y.css("top","0px"),E||(ma+=
3),y.css("height",ma+1+"px"));E&&C&&K.css("bottom","0px");!1!==a.options.rtl?(x.css("left","auto"),x.css("right","-"+(a.scrollPos.x-2).toString()+"px"),E&&(v.css("left","auto"),v.css("right","0px")),C&&(y.css("left","0px"),y.css("right","auto")),E&&C&&(K.css("left","0px"),K.css("right","auto"))):(x.css("left","-"+(a.scrollPos.x-2).toString()+"px"),x.css("right","auto"),E&&(v.css("left","0px"),v.css("right","auto")),C&&(y.css("left","auto"),y.css("right","0px")),E&&C&&(K.css("left","auto"),K.css("right",
"0px")));var c=n(function(){E&&N<W&&(Ua=0,da=2,na=v[0].clientWidth-4,na>da&&(Ua=na-da),Ga=Math.floor(Ua*(N-4)/W),9>Ga&&(Ga=9),H.css("width",Ga+"px"),D.x=W-N,0>D.x&&(D.x=0),Ia=D.x/(Ua-Ga-2));var b=a.currentList.length+1;C&&0<a.currentList.length&&A<b&&(ea=2,ua=y[0].clientHeight-4,Va=0,ua>ea&&(Va=ua-ea),Ha=Math.floor(Va*A/b),9>Ha&&(Ha=9),I.css("height",Ha+"px"),Wa=(b-A+1)/(Va-Ha-2),D.y=Math.floor((b-A+1)*z),0>D.y&&(D.y=0),0==G?I.css("top",ea+"px"):G+A-1==a.currentList.length&&I.css("top",ua-I[0].offsetHeight+
"px"));n.cancel(c)},1);n.cancel(b)},5)},rb=5,Xa=0,oa=0,Ya=0,sb=0,pa=!1,Za=!1,wa="none",Ka="normal",La=0,cb=null,O=!1,fa=!1,ga=angular.element('<ul class="iui-treeview-block" style="position:absolute;top:-9999999px"></ul>');a.updateActive=!1;a.updateStatus=0;var tb=function(b){var c=e(function(){b?oa++:oa--;Ya=(m[0].clientHeight-oa)/2+2;Ma.css("height",oa+"px");X.css("top",Ya+"px");b&&oa>=rb?(O=!0,ha(0),fa=pa=!1,e.cancel(c)):!b&&0>=oa&&(X&&X.remove(),xa=0,fa=!0,a.callLoadComplete(),e.cancel(c))},20)},
ub=function(){cb&&e.cancel(cb);R&&R.remove()};a.beginLoad=function(a){if(!pa)switch(pa=!0,a?(wa=void 0!=a.type?a.type:"none",Ka=void 0!=a.speed?a.speed:"normal",La=void 0!=a.opacity?a.opacity:0):(wa="none",Ka="normal",La=0),Na(La),wa){case "circular":ub();m.append(R);R.css("top",(m[0].clientHeight-R[0].offsetHeight)/2+"px");R.css("left",(m[0].clientWidth-R[0].offsetWidth)/2+"px");O=!0;fa=pa=!1;var b=0,c=3;switch(Ka){case "veryfast":c=7;break;case "fast":c=5;break;case "slow":c=2;break;case "veryslow":c=
1}cb=e(function(){b+=c;360<b&&(b=0);var a="rotate("+b+"deg)";R.css("-ms-transform",a);R.css("-webkit-transform",a);R.css("transform",a)},1);break;case "linear":a=angular.element('<div class="iui-load-block-progress" style="position:absolute;left:-9999px"></div>');m.append(a);rb=parseInt(getComputedStyle(a[0]).height,10);a.remove();Ma.css("width","0px");Ma.css("height","0px");m.append(X);xa=0;Xa=Math.floor(.5*m[0].clientWidth);oa=0;Ya=m[0].clientHeight/2+2;sb=(m[0].clientWidth-Xa)/2;X.css("width",
Xa+"px");X.css("top",Ya+"px");X.css("left",sb+"px");X.css("opacity","1");tb(!0);break;default:O=!0,fa=pa=!1}};a.endLoad=function(b){if(!Za)if(Za=!0,b=a.options.loadItems.indexOf(b),0<=b&&a.options.loadItems.splice(b,1),O){O=!1;var c=3,d=La,f=e(function(){fa&&(10<c||1<=d?(Na(1),Za=pa=fa=!1,wa="none",Ka="normal",La=void 0,e.cancel(f)):(d+=c/10,Na(d),c+=3))},1)}else Za=!1};var Na=function(a){x&&x.css("opacity",a);v&&v.css("opacity",a);y&&y.css("opacity",a);K&&K.css("opacity",a)},Ma=angular.element('<div class="iui-load-block-progress"></div>'),
X=angular.element('<div class="iui-load-block"></div>');X.append(Ma);var xa=0,ya=!1,R=angular.element('<div class="iui-load-circular"></div>'),ha=function(a){if(O&&"linear"==wa){ya=!1;var b=Math.floor(Xa*a/100),c=xa;a=10;switch(Ka){case "veryfast":a=2;break;case "fast":a=5;break;case "slow":a=15;break;case "veryslow":a=20}var d=b>c?Math.floor((b-c)/a):1,d=0<d?d:1,f=e(function(){c+=d;Ma.css("width",c+"px");c>=b&&(xa=b,ya=!0,e.cancel(f))},1)}else ya=!0},va={top:0,bottom:0},Gb=function(){z=0;va={top:0,
bottom:0};if(0<a.currentList.length&&t){for(var b=[],d=[],e=0,f=0;f<a.currentList.length&&10>f;f++)b.push(vb(f,!0)),d.push(c(b[f])(t)),m.append(d[f]),e++;if(0<e)var h=n(function(){var a=0;va=g.getMargin(d[0][0]);for(var b=0;b<e;b++)a+=d[b][0].offsetHeight,d[b].remove();z=Math.floor(a/e);n.cancel(h)},1)}},Hb=function(){m.append(ga);var b=n(function(){if(0<a.currentList.length){t=k.$new();t.data=wb();t.checkBoxStyle=a.options.checkBoxSettings.style;!t.checkBoxStyle&&a.options.controlStyle.item.checkBox&&
(t.checkBoxStyle=a.options.controlStyle.item.checkBox);a.refresh();t.$apply();Gb();var d=n(function(){var a=m[0].offsetHeight-6;E&&v&&(a-=v[0].offsetHeight);var b=(va.top+va.bottom)/2;A=0<z?Math.floor(a/(z+b))+1:100;ca=0;a="";for(b=0;b<A;b++)a+=vb(b),ca++;0<ca&&ga.append(c(a)(t));ha(70);S("scroll");n.cancel(d)},1)}else ha(70),S("scroll");n.cancel(b)},1)},S=function(b){if(ya&&!pa)switch(b){case "start":Na(0);a.updateCurrentList();Ib();ha(10);S("init");break;case "init":ga&&ga.remove();Fa||ta||qb();
aa();t&&t.$destroy();a.currentList.length>=A&&G+A-1>a.currentList.length&&(G=a.currentList.length-A+1);ha(20);S("items");break;case "items":Hb();break;case "scroll":a.updateViewSize();a.updateViewSize();a.updateScrollView();ha(80,"complete");S("complete");break;case "complete":ha(90);S("events");break;case "events":ga&&(x.empty(),x.append(ga.children()));a.allowEvents=!0;0<a.currentList.length&&ba();ha(100);S("end");break;case "end":ga&&ga.remove();switch(wa){case "circular":ub();xa=0;fa=!0;1==a.updateStatus&&
a.callLoadComplete();break;case "linear":tb(!1);break;default:xa=0,fa=!0,1==a.updateStatus&&a.callLoadComplete()}a.updateActive=!1;a.updateStatus--;0<a.updateStatus&&(ya=a.updateActive=!0,S("start"));0==a.updateStatus&&(a.updateView(),Na(1),a.callUpdateComplete())}else n(function(){S(b)},1)};a.updateCurrentLayout=function(){if(a.allowUpdate)if(0==a.currentList.length)a.updateLayout();else{a.updateCurrentList();a.updateView();var b=n(function(){a.updateViewSize();a.updateViewSize();a.updateScrollView();
n.cancel(b)},1)}};a.updateLayout=function(b){m.append(u.$tw);u.s1t(u.twp);b=!0;for(var c=m.parent();"body"!=c[0].tagName.toLowerCase();){if("none"==getComputedStyle(c[0]).display){b=!1;break}c=c.parent()}if(b&&a.allowUpdate&&(a.updateStatus++,!a.updateActive)){a.updateActive=!0;m.removeClass("iui-treeview-block-rtl");a.options.rtl&&m.addClass("iui-treeview-block-rtl");x.removeClass("iui-treeview-block-shift-left iui-treeview-block-rtl");x.addClass(Ra());a.allowEvents=!1;z=W=0;A=100;if(a.options.showCheckBoxes)for(a.updateCheckValues(),
b=a.getFullList(),c=0;c<b.length;c++)a.setDefaultCheckValue(b[c]);ya=!0;S("start")}};k.$watch(function(){return m[0].offsetWidth},function(b,c){100==A?a.updateLayout():b!=c&&a.updateCurrentLayout()});var V=null;k.$watch(function(){return m[0].offsetHeight},function(b,c){b!=c&&(V&&(n.cancel(V),V=null),V=n(function(){a.updateLayout();n.cancel(V);V=null},250))});k.onCheckValueChanging=function(b,c){var d=!1,e=c+G;if(a.isIndexInRange(e)){if((d=a.currentList[e])&&0==d[a.options.dataFields.allowEdit])return!1;
d=a.callCheckValueChanging(a.currentList[e],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked)}return d};k.onCheckValueChanged=function(b,c){var d=c+G;a.isIndexInRange(d)&&(a.callCheckValueChanged(a.currentList[d],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked),a.fillCheckList(a.currentList[d]))};a.setDefaultCheckValue=function(b){a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?void 0==b[a.options.dataFields.checkState]&&
(b[a.options.dataFields.checkState]="unchecked"):void 0==b[a.options.dataFields.checked]&&(b[a.options.dataFields.checked]=!1)};var Fb=function(b,c){var d=a.currentList[b],e=a.defaultStyle.item.general.normal,f=a.getCurrentItemStyle(d,a.getObjState(d)),d='<li class="'+e;f!=e&&(d+=" "+f);d+='" ';d=c?d+('style="position:absolute;top:-9999px;padding-left:'+a.indentList[b]+'px"'):d+('data-index="'+b+'"');!c&&0<a.indentList[b]&&(d=a.options.rtl?d+(' style="padding-right:'+a.indentList[b]+'px"'):d+(' style="padding-left:'+
a.indentList[b]+'px"'));d+=">";!1!==a.options.showStatusIcons&&(d+='<span class="'+ob(a.currentList[b])+'" data-element="statusicon"></span>');d+='<span class="'+ka(a.currentList[b])+'" data-element="expandbox"></span>';1==a.options.showCheckBoxes&&(d+='<iui-checkbox name="cb-'+g.getUniqueId(4)+'"',e=a.options.checkBoxSettings?1==a.options.checkBoxSettings.threeState:!1,f=a.currentList[b],e&&void 0==f[a.options.dataFields.checkState]?f[a.options.dataFields.checkState]="unchecked":void 0==f[a.options.dataFields.checked]&&
(f[a.options.dataFields.checked]=!1),e?(d+=' check-state="data['+b+"]."+a.options.dataFields.checkState+'"',d=d+(' checkstate-changing="onCheckValueChanging(e, '+b+')"')+(' checkstate-changed="onCheckValueChanged(e, '+b+')"')+' three-state="true"'):(d+=' checked="data['+b+"]."+a.options.dataFields.checked+'"',d=d+(' checked-changing="onCheckValueChanging(e, '+b+')"')+(' checked-changed="onCheckValueChanged(e, '+b+')"')),t&&(a.options.checkBoxSettings&&a.options.checkBoxSettings.style&&t.checkBoxStyle?
d+=' control-style="checkBoxStyle"':a.options.controlStyle.item.checkBox&&t.checkBoxStyle&&(d+=' control-style="checkBoxStyle"')),a.isItemEnabled(a.currentList[b])||(d+=' enabled="false"'),d+=' style="display:inline-block;margin:0 2px;padding-bottom:2px;vertical-align:middle;',0<za&&(d+="width: "+za+"px;"),d+='"></iui-checkbox>');!1!==a.options.showIcons&&pb(a.currentList[b])&&(d+='<span class="'+nb(a.currentList[b])+'" data-element="icon"></span>');e=a.defaultStyle.item.content.normal;a.options.controlStyle.item.content.normal!=
e&&(e+=" "+a.options.controlStyle.item.content.normal);f=a.getCurrentItemContentStyle(a.currentList[b],"normal");a.currentList[b].content?(d=d+('<div class="'+e+" "+f+'" data-element="content">')+a.currentList[b][a.options.dataFields.content],d+="</div>"):(d+='<span class="'+e+" "+f+'" data-element="content"',!c&&a.currentList[b].contextMenu&&(d+=' iui-contextmenu menu-items="data['+b+'].contextMenu"'),d+=">",d=c?d+a.currentList[b][a.options.dataFields.text]:d+("{{data["+b+"]."+a.options.dataFields.text+
"}}"),d+="</span>");return d+="</li>"},vb=function(b,c){var d='<li iui-class="{{data['+b+'].style.general}}" data-index="{{data['+b+'].index}}"',d=c?d+' style="position:absolute;top:-9999px;left:-9999px;"':a.options.rtl?d+(' iui-style="padding-right:{{data['+b+'].indent}}px"'):d+(' iui-style="padding-left:{{data['+b+'].indent}}px"'),d=d+(' iui-contextmenu menu-items="data['+b+"].item."+a.options.dataFields.contextMenu+'" menu-update="{{data['+b+'].updateContextMenu}}"'),d=d+(' ng-show="data['+b+'].visible" style="position:relative;overflow:hidden;">');
0!=a.options.showStatusIcons&&(d+='<span iui-class="{{data['+b+'].statusIcon}}" data-element="status-icon"></span>');d+='<span iui-class="{{data['+b+'].expandBox}}" data-element="expandbox"';a.getTemplateUrl()&&(d+=0!=a.options.rtl?' style="float:right"':' style="float:left"');d+="></span>";a.options.showExpandBoxes&&1==a.options.showLines&&(d+='<span class="iui-treeview-line" ng-repeat="line in data['+b+'].lines" iui-style="top:{{line.top}}px;left:{{line.left}}px;right:{{line.right}}px;height:{{line.height}}px;width:{{line.width}}px;"></span>');
1==a.options.showCheckBoxes&&(d+='<iui-checkbox name="cb-'+g.getUniqueId(4)+'"',a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?(d+=' check-state="data['+b+"].item."+a.options.dataFields.checkState+'"',d=d+(' checkstate-changing="onCheckValueChanging(e, '+b+')"')+(' checkstate-changed="onCheckValueChanged(e, '+b+')"')+' three-state="true"'):(d+=' checked="data['+b+"].item."+a.options.dataFields.checked+'"',d=d+(' checked-changing="onCheckValueChanging(e, '+b+')"')+(' checked-changed="onCheckValueChanged(e, '+
b+')"')),t&&(a.options.checkBoxSettings&&a.options.checkBoxSettings.style&&t.checkBoxStyle?d+=' control-style="checkBoxStyle"':a.options.controlStyle.item.checkBox&&t.checkBoxStyle&&(d+=' control-style="checkBoxStyle"')),d+=' enabled="data['+b+"].item."+a.options.dataFields.enabled+'"',d+=' style="display:inline-block;margin:0 2px;padding-bottom:2px;',0<za&&(d+="width: "+za+"px;"),d+='" iui-show="{{data['+b+'].visible}}" show-default="true"></iui-checkbox>');a.getTemplateUrl()||0==a.options.showIcons||
(d+='<span iui-class="{{data['+b+'].icon}}" data-element="icon"></span>');a.getTemplateUrl()?(d+='<iui-item-content obj="data['+b+"].item."+a.options.dataFields.templateObj+'" template-url="{{data['+b+'].templateUrl}}" iui-show="{{data['+b+'].templateVisible}}" draggable="{{data['+b+'].draggable}}" tabindex="{{data['+b+'].tabindex}}" data-element="template-content"',"inline"==a.getTemplateDisplay()&&(d+='show-inline="true"'),d+=" ng-cloak></iui-item-content>"):(d=d+('<span iui-class="{{data['+b+'].style.content}}" draggable="{{data['+
b+'].draggable}}" tabindex="{{data['+b+'].tabindex}}" data-element="content"')+(' iui-tooltip="data['+b+"].item."+a.options.dataFields.tooltip+'">'),d+="{{data["+b+"].item."+a.options.dataFields.text+"}}",d+="</span>");return d+"</li>"},za=0,Ib=function(){if(1==a.options.showCheckBoxes){var b=angular.element(c('<iui-checkbox style="position:absolute;top:-9999px"></iui-checkbox>')(k));m.append(b);za=0;b&&0<b.children().length&&(za=parseInt(getComputedStyle(angular.element(b.children().eq(0))[0]).width,
10));b.remove()}};a.getTemplateDisplay=function(){return a.options.templateSettings?a.options.templateSettings.display:"block"};a.getTemplateUrl=function(){return a.options.templateSettings?a.options.templateSettings.url:null};a.isTherePrevItem=function(b){var c=!1;if(b)for(var d=a.currentList.indexOf(b)-1;0<=d;d--)if(a.currentList[d][a.options.dataFields.pid]==b[a.options.dataFields.pid]){c=!0;break}return c};a.isThereNextItem=function(b){var c=!1;if(b)for(var d=a.currentList.indexOf(b)+1;d<a.currentList.length;d++)if(a.currentList[d][a.options.dataFields.pid]==
b[a.options.dataFields.pid]){c=!0;break}return c};var xb=function(b,c,d,e,f){var g={top:0,left:0==a.options.rtl?c*a.options.indent+7:"auto",right:0!=a.options.rtl?c*a.options.indent+8:"auto",width:0,height:z},h=a.isTherePrevItem(b),k=a.isThereNextItem(b);e?(k||(g.height=Math.floor(z/2)),h||f||(g.height=Math.floor(z/2),g.top=Math.floor(z/2)),(h||k||f)&&d.push(g)):k&&d.push(g);e&&!a.isThereVisibleChildren(b)&&(g={width:8,height:0},g.top=Math.floor(z/2),g.left=0==a.options.rtl?c*a.options.indent+7:"auto",
g.right=0!=a.options.rtl?c*a.options.indent+8:"auto",d.push(g))},Jb=function(b,c,d){var e;if(d&&a.options.showExpandBoxes&&1==a.options.showLines)if(a.isThereChildItems||b&&b[a.options.dataFields.hasChildren]){e=a.indentList[c]/a.options.indent;for(var f=b,g=a.parentList[c].parent,h=[],k=e;0<=k&&f;k--)k==e?xb(b,k,h,!0,g):f&&xb(f,k,h,!1,g),f=g,g=a.getItemCurrentIndex(f),g=0<=g&&g<a.parentList.length?a.parentList[g].parent:null;e=h}else e=[];else e=[];var f=d?ka(b):"",h=d?a.isItemEnabled(b)&&a.isDragAllowed(b):
!1,k=d?nb(b):"",g=d?0!=a.options.showIcons&&pb(b):!1,l=d?a.indentList[c]:0,m=d?ob(b):"",n=d?0!=a.options.showStatusIcons&&(b?b[a.options.dataFields.statusIcon]:!1):!1,p;p=d?1==a.options.allowFocus&&a.isItemEnabled(a.currentList[c])?a.getTabIndex().toString()+(c+1).toString():"":"";var u=a.getTemplateUrl(),t;if(d){t=a.getTemplateUrl();var v=a.currentList[c];t=t&&""!=t&&void 0!=v[a.options.dataFields.templateObj]&&null!=v[a.options.dataFields.templateObj]?!0:!1}else t=!1;return{lines:e,expandBox:f,
draggable:h,icon:k,iconVisible:g,indent:l,index:c,item:d?b:{},statusIcon:m,statusIconVisible:n,style:{},tabindex:p,templateUrl:u,templateVisible:t,updateContextMenu:d?null!=b[a.options.dataFields.contextMenu]:!1,visible:d}},wb=function(){for(var b=[],c=G;c<G+A;c++)b.push(Jb(a.currentList[c],c,c<a.currentList.length));return b};a.getItemScope=function(){return t};var zb=function(){t&&(a.allowEvents=!1,yb(!1),t.data=wb(),a.options.selectedItem&&!a.isItemEnabled(a.options.selectedItem)&&(a.options.selectedItem[a.options.dataFields.selected]=
!1,a.options.selectedItem=null,a.updateSelectionList()),a.refresh(null,null,!1),t.$apply(),a.allowEvents=!0)};a.updateView=function(a){if(a)zb();else var b=n(function(){zb();n.cancel(b)},1)};a.refresh=function(b,c,d){if(b)switch(b.type){case "item":if(t&&(c=a.getItemCurrentIndex(b)-G,0<=c&&c<t.data.length&&t.data[c].visible)){c=t.data[c];var e=a.getObjState(b),f={content:"",general:"",label:""},g;g=a.defaultStyle.item.general.normal;a.options.controlStyle.item.general.normal!=g&&(g+=" "+a.options.controlStyle.item.general.normal);
f.general=g;g=a.defaultStyle.item.content.normal;a.options.controlStyle.item.content.normal!=g&&(g+=" "+a.options.controlStyle.item.content.normal);f.content=g;g=a.getCurrentItemStyle(b,e);g!=a.options.controlStyle.item.general.normal&&(f.general+=" "+g);b=a.getCurrentItemContentStyle(b,e);b!=a.options.controlStyle.item.content.normal&&(f.content+=" "+b);c.style=f;void 0==d&&t&&t.$apply()}}else{for(b=G;b<G+A;b++)b<a.currentList.length?a.refresh(a.currentList[b],null,!1):t&&(c=b-G,0<=c&&c<t.data.length&&
t.data[c].visible&&(t.data[c].style=a.defaultStyle.item.general.normal));1==d&&t&&t.$apply()}};a.moveItem=function(b,c,d,e){if(b){a.allowUpdate=!1;var f=-1;switch(d){case "first":f=0;break;case "at":f=e}if(Array.isArray(b)){e=[];for(var g=0;g<b.length;g++){for(var h=!1,k=a.getParent(b[g]);k;){if(0<=b.indexOf(k)){h=!0;break}k=a.getParent(k)}h||e.push(b[g])}if(0<e.length)if(b=a.getObjCurrentIndex(e[0]),g=a.getObjCurrentIndex(e[e.length-1]),b<=g)for(g=0;g<e.length;g++)db(e[g],c,f,d);else for(g=e.length-
1;0<=g;g--)db(e[g],c,f,d)}else db(b,c,f,d);a.allowUpdate=!0;a.updateCurrentLayout();a.callChange()}};var db=function(b,c,d,e){a.dataObj.removeAt(b,-1,null,a.objIsRemoved)&&("first"==e||"last"==e||"at"==e?a.dataObj.insertAt(b,d,c,a.itemIsAdded):"before"==e?a.dataObj.insertByRef(b,c,!1,a.itemIsAdded):"after"==e&&a.dataObj.insertByRef(b,c,!0,a.itemIsAdded))},Ea=!1,Aa=0,$a=null,eb=.5;a.isScrollBarVisible=function(a){switch(a){case "horizontal":return E;case "vertical":return C}return E&&C};a.prevScrollPos=
{x:0,y:0};a.scrollPos={x:0,y:0};a.getScrollPos=function(){return a.scrollPos};a.setScrollPos=function(b,c){if(!O&&b){var d=!0;0>b.x&&(b.x=0,d=!1);b.x>D.x&&(b.x=D.x,d=!1);0>b.y&&(b.y=0,d=!1);b.y>D.y&&(b.y=D.y,d=!1);a.scrollPos=b;Ja=Math.floor(a.scrollPos.y/(z*Wa));var e,f=ea+Ja;E&&H&&(e=!1!==a.options.rtl?Math.floor(a.scrollPos.x/Ia)-(na-H[0].offsetWidth-da):Math.floor(a.scrollPos.x/Ia)+da,H.css("left",e+"px"));C&&I&&I.css("top",f+"px");Ab();yb(!0,c);d&&a.callScrollPosChanged()}};var fb=function(a){return 0<
a.x&&a.x<D.x||0<a.y&&a.y<D.y},Ta=function(b,c,d,f){Ea||(Aa=0,Ea=!0,$a=e(function(){if(1!=b.which)la();else{var e=d,f=a.getScrollPos();e||(0===Aa&&(Aa=5),Aa+=5+Wa,eb+=.5,e=Aa+=Math.floor(eb));f.y=c?f.y+e:f.y-e;a.setScrollPos(f);(0>=f.y||a.getScrollPos().y<f.y)&&la()}},f?f:100))},la=function(){Ea&&($a&&(e.cancel($a),$a=null),Ea=!1,Aa=0,eb=.5)};a.cancelScrollTimer=function(){la()};a.scrollTo=function(b,c){if(b){var d=a.getItemCurrentIndex(b);if(a.isIndexInRange(d)){var e=0,f=d;switch(c){case "center":e=
Math.floor(ca/2);f=d>e?d-e:0;break;case "bottom":e=ca-2,f=d>e?d-e:0}var g=n(function(){a.setScrollPos({x:a.scrollPos.x,y:f*z});n.cancel(g)},1)}}};var Bb=function(b){if(!O&&1===b.which){H[0].getBoundingClientRect();b=a.getMousePos(b);u.scrollMousePos||(u.scrollMousePos=b);var c=H[0].offsetLeft+(b.x-u.scrollMousePos.x);c<da?c=da:c+H[0].offsetWidth>na&&(c=na-H[0].offsetWidth);H.css("left",c+"px");u.scrollMousePos=b;a.prevScrollPos={x:a.scrollPos.x,y:a.scrollPos.y};a.scrollPos.x=!1!==a.options.rtl?parseInt((na-
H[0].offsetLeft-H[0].offsetWidth)*Ia,10):parseInt((H[0].offsetLeft-da)*Ia,10);Ab();(fb(a.scrollPos)||a.scrollPos.x!=a.prevScrollPos.x)&&a.callScrollPosChanged()}},Ab=function(){if(x){var b=a.scrollPos.x;0>b&&(b=0);b>D.x&&(b=D.x);b=2-b;!1!==a.options.rtl?x.css("right",b+"px"):x.css("left",b+"px")}},Cb=function(b){if(!O&&1===b.which){I[0].getBoundingClientRect();b=a.getMousePos(b);u.scrollMousePos||(u.scrollMousePos=b);var c=I[0].offsetTop+(b.y-u.scrollMousePos.y);c<ea?c=ea:c+I[0].offsetHeight>ua&&
(c=ua-I[0].offsetHeight);I.css("top",c+"px");u.scrollMousePos=b;Ja=c-ea;a.prevScrollPos={x:a.scrollPos.x,y:a.scrollPos.y};a.scrollPos.y=Math.floor(Ja*Wa*z);(fb(a.scrollPos)||a.scrollPos.y!=a.prevScrollPos.y)&&a.callScrollPosChanged();newIndex=0<z?Math.floor(a.scrollPos.y/z):0;newIndex+A-1>=a.currentList.length&&(newIndex=a.currentList.length-A+1,newIndex+=5);0>newIndex&&(newIndex=0);newIndex!==G&&(G=newIndex,a.updateView(!0))}},yb=function(b,c){if(!(0==b&&0>=z)){newIndex=0<z?Math.floor(a.scrollPos.y/
z):0;a.scrollPos.y==D.y&&newIndex--;if(a.currentList.length>=A&&newIndex+A-1>a.currentList.length){newIndex=a.currentList.length-A+1;var d=x.find("li");d&&0<d.length&&(d=angular.element(d[d.length-1]),d[0].offsetTop+d[0].offsetHeight>m[0].clientHeight&&newIndex++)}0>newIndex&&(newIndex=0);newIndex!==G&&(G=newIndex,0!=b&&a.updateView(c))}};m.bind("scroll",function(a){m[0].scrollTop=0;m[0].scrollLeft=0});var Db=function(b,c){if(C){document.activeElement&&document.activeElement.blur();var d=a.hoverItem;
a.hoverItem=null;a.refresh(d);d=Math.floor(m[0].clientHeight/4);a.prevScrollPos={x:a.scrollPos.x,y:a.scrollPos.y};a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+d*c*-1});fb(a.scrollPos)||a.scrollPos.y==a.prevScrollPos.y||a.callScrollPosChanged()}};m.bind("mousewheel",function(b){b.preventDefault();if(!O&&a.options.enabled){var c=0;b.wheelDelta?c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,b.originalEvent.wheelDelta||-b.originalEvent.detail)));Db(b,
c)}});m.bind("DOMMouseScroll",function(b){b.preventDefault();if(!O&&a.options.enabled){var c=0;b.detail?c=Math.max(-1,Math.min(1,-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,-b.originalEvent.detail)));Db(b,c)}});m.bind("mousemove",function(a){Fa?Bb(a):ta&&Cb(a);a.stopPropagation()});var gb=function(b){a.dropMark()},hb=function(a){la()},ib=function(b){a.removeDropMark();a.dragIcon&&angular.element(a.dragIcon).remove();a.cancelScrollTimer();a.dragDropStatus(!1)},kb=function(a){Fa?Bb(a):ta&&
Cb(a)},lb=function(b){a.dropMark();ta&&a.updateView();la();u.scrollMousePos=null;ta=Fa=!1},jb=function(b){switch(b.keyCode){case 16:a.multiSelection(!1);a.shiftKeyStatus(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||(a.multiSelection(!1),a.shiftKeyStatus(!1))}};angular.element(f).bind("dragenter",gb);angular.element(f).bind("dragover",hb);angular.element(f).bind("dragend",ib);angular.element(f).bind("mousemove",kb);angular.element(f).bind("mouseup",
lb);angular.element(f).bind("keyup",jb);var Oa={x:0,y:0},ia={x:0,y:0};m.bind("touchstart",function(b){b.preventDefault();a.options.enabled&&(b=a.getTouchData(b))&&0<b.length&&(Oa={x:b[0].pageX,y:b[0].pageY})});m.bind("touchend",function(b){if(a.options.enabled){(b=a.getTouchData(b))&&0<b.length&&(ia={x:b[0].pageX,y:b[0].pageY});var c=ia.x-Oa.x,d=ia.y-Oa.y;(20<Math.abs(c)||20<Math.abs(d))&&document.activeElement&&document.activeElement.blur();var f=!1,g=!1,h=Oa,k=a.scrollPos.x,l=a.scrollPos.y,m=e(function(){var b=
a.scrollPos;-20>c?(h.x-=10,h.x>ia.x?b.x+=10:(b.x=k-c,f=!0)):20<c?(h.x+=10,h.x<ia.x?b.x-=10:(b.x=k-c,f=!0)):f=!0;-20>d?(h.y-=10,h.y>ia.y?b.y+=10:(b.y=l-d,g=!0)):20<d?(h.y+=10,h.y<ia.y?b.y-=10:(b.y=l-d,g=!0)):g=!0;a.setScrollPos(b);f&&g&&e.cancel(m)},5);Oa=ia}});u=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){return"<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>"+(a[1]+
a[4]+a[2]+a[0]+a[3])+"</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(u.tpar));this.tmp=300;this.twp=200*this.tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",m[0].scrollTop+"px"),this.$tw.css("left",m[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",
m[0].scrollTop+"px"),this.$tw.css("left",m[0].scrollLeft+"px"))};this.s1t=function(a){u.s3t();this.trlTime=n(function(){u.trActive||(u.trCount=0,u.trActive=!0,u.trId=e(function(){u.animTr()},1E3))},a)};this.s3t=function(){this.trId&&(e.cancel(this.trId),this.trId=null);this.trlTime&&(n.cancel(this.trlTime),this.trlTime=null);this.trActive=!1};this.s2t=function(){this.s3t();this.trActive=!1;this.$tw.remove()};m.append(this.$tw);this.s1t(this.twp);angular.isDefined(k.options)?a.updateOptions(k.options):
(0==k.allowAnimation&&(a.options.allowAnimation=k.allowAnimation),1==k.allowDrag&&(a.options.allowDrag=k.allowDrag),0==k.allowDrop&&(a.options.allowDrop=k.allowDrop),angular.isDefined(k.animationSpeed)&&200!==k.animationSpeed&&(a.options.animationSpeed=k.animationSpeed),0==k.allowFocus&&(a.options.allowFocus=k.allowFocus),1==k.autoCheck&&(a.options.autoCheck=k.autoCheck),0==k.autoExpand&&(a.options.autoExpand=k.autoExpand),angular.isDefined(k.checkboxSettings)&&a.updateCheckBoxSettings(k.checkboxSettings),
angular.isDefined(k.controlStyle)&&a.updateControlStyle(k.controlStyle),angular.isDefined(k.editorSettings)&&a.updateEditorSettings(k.editorSettings),0==k.enabled&&(a.options.enabled=k.enabled),angular.isDefined(k.fields)&&(a.updateDataFields(k.fields),a.updateData()),!0===k.hoverSelection&&(a.options.hoverSelection=k.hoverSelection),angular.isDefined(k.indent)&&(a.options.indent=k.indent),angular.isDefined(k.itemIcon)&&(a.options.itemIcon=k.itemIcon),angular.isDefined(k.labelEdit)&&(a.options.labelEdit=
k.labelEdit),!0===k.rtl&&(a.options.rtl=k.rtl),angular.isDefined(k.selectedIndex)&&(a.options.selectedIndex=k.selectedIndex),angular.isDefined(k.selectedItem)&&(a.options.selectedItem=k.selectedItem),angular.isDefined(k.selectionMode)&&(a.options.selectionMode=k.selectionMode),!0===k.showCheckBoxes&&(a.options.showCheckBoxes=k.showCheckBoxes),!1===k.showExpandBoxes&&(a.options.showExpandBoxes=k.showExpandBoxes),!1===k.showIcons&&(a.options.showIcons=k.showIcons),!0===k.showLines&&(a.options.showLines=
k.showLines),!0===k.showStatusIcons&&(a.options.showStatusIcons=k.showStatusIcons),angular.isDefined(k.sorting)&&(a.options.sorting=k.sorting),angular.isDefined(k.templateSettings)&&a.updateTemplateSettings(k.templateSettings));var Kb=n(function(){a.updateLayout();n.cancel(Kb)},250)}}}]);